define(["jquery","core/config","core/str","core/notification","block_certification_report/select2"],function(a,b,c,d){return{initialise:function(){a(".select2").select2({width:"75%"}),a(document).on("click",".cancelbtn",function(){a(".exemption-modal-wrapper").remove()}),a(document).on("click",".deletebtn",function(){var c=a('input[name="exemption_userid"]').val(),d=a('input[name="exemption_certifid"]').val();a.ajax({type:"POST",url:b.wwwroot+"/blocks/certification_report/ajax/exemption.php",dataType:"HTML",data:{action:"deleteexmption",userid:c,certifid:d},success:function(){location.reload()}})}),a(document).on("click",".savebtn",function(){var e=a("#id_reason").val(),f=a('input[name="exemption_userid"]').val(),g=a('input[name="exemption_certifid"]').val(),h="";""===e?(a("#id_reason").parent().find(".error").remove(),c.get_string("reasonrequired","block_certification_report").done(function(b){a("#id_reason").parent().append('<span class="error">'+b+"</span>")}).fail(d.exception)):(a("#id_timeexpires_enabled").is(":checked")&&(h=a("#id_timeexpires_year").val()+"-"+a("#id_timeexpires_month").val()+"-"+a("#id_timeexpires_day").val()),a.ajax({type:"POST",url:b.wwwroot+"/blocks/certification_report/ajax/exemption.php",dataType:"HTML",data:{action:"saveexemption",reason:e,timeexpires:h,userid:f,certifid:g},success:function(){c.get_string("notrequired","block_certification_report").done(function(b){var c='<a href="#" class="setexemption" data-userid="'+f+'" data-certifid="'+g+'">'+b+"</a>";a("#certif_data_"+f+"_"+g).html(c),a(".exemption-modal-wrapper").remove()}).fail(d.exception)}}))}),a(document).on("click","#id_cancel",function(b){b.preventDefault(),a(".select2, .select2-match").val(null).trigger("change")}),a(document).on("click","#id_timeexpires_enabled",function(){var b=a(this).parent().parent();a(this).is(":checked")?b.find("select").removeAttr("disabled"):b.find("select").attr("disabled","disabled")}),a(document).on("click",".setexemption",function(){var c=a(this).data("userid"),d=a(this).data("certifid");a.ajax({type:"GET",url:b.wwwroot+"/blocks/certification_report/ajax/exemption.php",dataType:"HTML",data:{action:"getexemptionform",userid:c,certifid:d},success:function(b){a(".exemption-modal-wrapper").remove(),a(".block_certification_report_data").after(b),a("#id_timeexpires_enabled").is(":checked")||a(".exemption-modal").find("select").attr("disabled","disabled")}})}),a(document).on("click",".reset-certification",function(){a(this).removeClass("fa-undo").addClass("fa-spinner fa-spin");var c=a(this).data("userid"),d=a(this).data("certifid");a.ajax({type:"POST",url:b.wwwroot+"/blocks/certification_report/ajax/reset.php",dataType:"HTML",data:{action:"resetcertification",userid:c,certifid:d},success:function(){location.reload()}})})}}});