define(["jquery","core/config","core/str","core/notification","core/log","block_certification_report/clipboard","block_certification_report/select2","theme_bootstrap/bootstrap"],function(a,b,c,d,e,f){return{initialise:function(){a("select.select2").select2({width:"75%"}),a(document).on("click",".cancelbtn",function(){a(".exemption-modal-wrapper").remove()}),a(document).on("click",".deletebtn",function(){var c=a('input[name="exemption_userid"]').val(),d=a('input[name="exemption_certifid"]').val();a.ajax({type:"POST",url:b.wwwroot+"/blocks/certification_report/ajax/exemption.php",dataType:"HTML",data:{action:"deleteexmption",userid:c,certifid:d},success:function(){location.reload()}})}),a(document).on("click",".savebtn",function(){var e=a("#id_reason").val(),f=a('input[name="exemption_userid"]').val(),g=a('input[name="exemption_certifid"]').val(),h="";""===e?(a("#id_reason").parent().find(".error").remove(),c.get_string("reasonrequired","block_certification_report").done(function(b){a("#id_reason").parent().append('<span class="error">'+b+"</span>")}).fail(d.exception)):(a("#id_timeexpires_enabled").is(":checked")&&(h=a("#id_timeexpires_year").val()+"-"+a("#id_timeexpires_month").val()+"-"+a("#id_timeexpires_day").val()),a.ajax({type:"POST",url:b.wwwroot+"/blocks/certification_report/ajax/exemption.php",dataType:"json",data:{action:"saveexemption",reason:e,timeexpires:h,userid:f,certifid:g},success:function(b){b.hasexpired?location.reload():c.get_string("notrequired","block_certification_report").done(function(b){var c='<a href="#" class="setexemption" data-userid="'+f+'" data-certifid="'+g+'">'+b+"</a>";a("#certif_data_"+f+"_"+g).html(c),a(".exemption-modal-wrapper").remove()}).fail(d.exception)}}))}),a(document).on("click","#id_cancel",function(b){b.preventDefault(),a(".select2, .select2-match").val(null).trigger("change")}),a(document).on("click","#id_timeexpires_enabled",function(){var b=a(this).parent().parent();a(this).is(":checked")?b.find("select").removeAttr("disabled"):b.find("select").attr("disabled","disabled")}),a(document).on("click",".setexemption",function(){var c=a(this).data("userid"),d=a(this).data("certifid");a.ajax({type:"GET",url:b.wwwroot+"/blocks/certification_report/ajax/exemption.php",dataType:"HTML",data:{action:"getexemptionform",userid:c,certifid:d},success:function(b){a(".exemption-modal-wrapper").remove(),a(".block_certification_report_data").after(b),a("#id_timeexpires_enabled").is(":checked")||a(".exemption-modal").find("select").attr("disabled","disabled")}})}),a(document).on("click",".reset-certification",function(){a(this).removeClass("fa-undo").addClass("fa-spinner fa-spin");var c=a(this).data("userid"),d=a(this).data("certifid");a.ajax({type:"POST",url:b.wwwroot+"/blocks/certification_report/ajax/reset.php",dataType:"HTML",data:{action:"resetcertification",userid:c,certifid:d},success:function(){location.reload()}})});var e;a(document).on("click","a[data-toggle=modal]",function(){var b=a(this).data("target"),c=a(this).data("label");e=a(b+" .modal-body").html(),a(b+"-label").text(c),a(b+" .modal-body").load(a(this).data("url"))}),a(document).on("hidden.bs.modal",".modal",function(){a(this).data("modal",null),a("#info-modal-label").empty(),a(this).find(".modal-body").html(e)});var g=a("#managelink-form");a(document).on("click",".edit-link",function(){var b=a(this).data();g.find("#id_linkname").val(b.name),g.find("#id_linkurl").val(b.linkurl),g.find("input[name='id']").val(b.id),g.find("#id_actualregion").val(b.region),g.find("#id_geographicregion").val(b.georegion),g.find("#id_cancel").css("display","inline"),a(window).scrollTop(g.position().top)}),a(document).on("click","#id_cancel",function(){g.find("#id_linkname").val(""),g.find("#id_linkurl").val(""),g.find("input[name='id']").val(""),g.find("#id_actualregion").val("0"),g.find("#id_geographicregion").val("0"),g.find("#id_cancel").css("display","none")});var h=a("#delete-confirm-modal");a(document).on("click",".delete-link",function(){var c=a(this).data("id");h.modal("show"),h.on("shown.bs.modal",function(){var d=a(this);d.on("click","#delete-confirm-btn",function(){a.ajax({type:"POST",url:b.wwwroot+"/blocks/certification_report/ajax/links.php",data:{action:"delete",id:c},success:function(){location.reload()}})})})});var i=new f(".copy-to-clipboard");i.on("success",function(b){var c=a(b.trigger);c.tooltip({container:"body",trigger:"manual",title:c.data("title-success")}).tooltip("show"),c.on("mouseout",function(){c.tooltip("destroy")})}),i.on("error",function(b){var c=a(b.trigger);c.tooltip({container:"body",trigger:"manual",title:c.data("title-error")}).tooltip("show"),c.on("mouseout",function(){c.tooltip("destroy")})})}}});