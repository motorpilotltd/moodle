define(["jquery","core/config","core/templates"],function(a,b,c){var d={change_links:function(c,e){var f=null;a(".block_report_table."+c+" .content .rb-display-table-container").find("div.paging a, th.header a").each(function(){a(this).click(function(g){g.preventDefault();var h=a(this),i=h.attr("href"),j=i.slice(i.indexOf("?")+1);if(j+="&sesskey="+b.sesskey+"&blockid="+e,f&&f.abort(),0===a(g.target).siblings(".instantreportwait").length){var k=a('<div class="instantreportwait"></div>'),l=a(".block_report_table."+c+" .content .rb-display-table-container");l.addClass("loading"),l.append(k),a(".reportbuilder-table").html('<img src="'+M.cfg.wwwroot+'/pix/y/loading.gif"/>')}f=d.refresh_results(c,j,function(){d.change_links(c,e)})})})},refresh_results:function(c,d,e){return a.get(b.wwwroot+"/blocks/report_table/ajax_instantreport.php?"+d).done(function(b){var d=a(".block_report_table."+c+" .content");d.find(".instantreportwait").remove(),d.find(".rb-display-table-container").remove(),d.prepend(a(b).find(".rb-display-table-container")),d.find("form").remove(),e&&e()})},populatelist:function(){var c=a("#id_config_savedsearch");a("#id_config_reportid").change(function(){var d=a(this).val();""!==d&&(c.attr("disabled","disabled"),M.util.js_pending("block_report_table-populatelist"),a.ajax({type:"POST",url:b.wwwroot+"/blocks/report_table/ajax_list_saved.php",data:{reportid:d,sesskey:M.cfg.sesskey},success:function(a){c.find("option").remove(),c.append('<option value="">'+M.util.get_string("allavailabledata","block_report_table")+"</option>");for(var b in a)c.append('<option value="'+b+'">'+a[b]+"</option>");c.removeAttr("disabled"),M.util.js_complete("block_report_table-populatelist")}}))})}};return d});