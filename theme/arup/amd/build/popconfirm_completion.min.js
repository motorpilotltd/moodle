define(["jquery","theme_bootstrap/bootstrap","core/log"],function($,bootstrap,log){"use strict";log.debug("Popconfirm");var myDefaultWhiteList=$.fn.tooltip.Constructor.DEFAULTS.whiteList;return myDefaultWhiteList.button=[],$.fn.extend({popConfirm:function(options){var defaults={title:"Confirmation",content:"Are you really sure ?",placement:"right",container:"body",yesBtn:"Yes",noBtn:"No"},last=null;return options=$.extend(defaults,options),this.each(function(){var self=$(this),arrayActions=[],arrayDelegatedActions=[],eventToConfirm,optName,optValue,i,elmType,code,form;for(optName in options)options.hasOwnProperty(optName)&&(optValue=$(this).attr("data-confirm-"+optName),optValue&&(options[optName]=optValue));if(jQuery._data(this,"events")&&jQuery._data(this,"events").click){for(i=0;i<jQuery._data(this,"events").click.length;i+=1)arrayActions.push(jQuery._data(this,"events").click[i].handler);$(self).unbind("click")}if(self.data("remote")&&jQuery._data(document,"events")&&jQuery._data(document,"events").click)for(i=0;i<jQuery._data(document,"events").click.length;i+=1)elmType=self[0].tagName.toLowerCase(),jQuery._data(document,"events").click[i].selector&&jQuery._data(document,"events").click[i].selector.indexOf(elmType+"[data-remote]")!==-1&&arrayDelegatedActions.push(jQuery._data(document,"events").click[i].handler);self.attr("onclick")&&(code=self.attr("onclick"),arrayActions.push(function(){eval(code)}),$(self).prop("onclick",null)),!self.data("remote")&&self.attr("href")&&arrayActions.push(function(){window.location.href=self.attr("href")}),self.attr("type")&&"submit"===self.attr("type")&&(form=$(this).parents("form:first"),arrayActions.push(function(){form.submit()})),self.popover({trigger:"manual",title:options.title,html:!0,placement:options.placement,container:options.container,content:options.content+'<p class="button-group" style="margin-top: 10px; text-align: center;"><button type="button" class="btn btn-default btn-small confirm-dialog-btn-abort">'+options.noBtn+'</button> <button type="button" class="btn btn-small btn-danger confirm-dialog-btn-confirm">'+options.yesBtn+"</button></p>"}).click(function(a){last&&last!==self&&last.popover("hide").removeClass("popconfirm-active"),last=self}),$(document).on("click",function(){last&&last.popover("hide").removeClass("popconfirm-active")}),self.bind("click",function(a){eventToConfirm=a,a.preventDefault(),a.stopPropagation(),$(".popconfirm-active").not(self).popover("hide").removeClass("popconfirm-active"),self.popover("show").addClass("popconfirm-active"),$(document).find(".popover .confirm-dialog-btn-confirm").bind("click",function(a){for(i=0;i<arrayActions.length;i+=1)arrayActions[i].apply(self);for(i=0;i<arrayDelegatedActions.length;i+=1)arrayDelegatedActions[i].apply(self,[eventToConfirm.originalEvent]);self.popover("hide").removeClass("popconfirm-active")}),$(document).find(".popover .confirm-dialog-btn-abord").bind("click",function(a){self.popover("hide").removeClass("popconfirm-active")})})})}}),{init:function(){$(document).ready(function(){$("a[href*='togglecompletion']").popConfirm({title:M.util.get_string("popconfirm:togglecompletion:title","theme_arup"),content:M.util.get_string("popconfirm:togglecompletion:content","theme_arup"),yes:M.util.get_string("popconfirm:togglecompletion:yes","theme_arup"),no:M.util.get_string("popconfirm:togglecompletion:no","theme_arup"),placement:"bottom"})}),log.debug("Popconfirm init")}}});