!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports&&"string"!=typeof exports.nodeName?module.exports=b():a.Croppie=b()}("undefined"!=typeof self?self:this,function(){function a(a){if(a in X)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=W.length;c--;)if(a=W[c]+b,a in X)return a}function b(a,b){var c=Y.indexOf(a)>-1?Y:Z,d=c.indexOf(a),e=b/90%c.length;return c[(c.length+d+e%c.length)%c.length]}function c(a,b){a=a||{};for(var d in b)b[d]&&b[d].constructor&&b[d].constructor===Object?(a[d]=a[d]||{},c(a[d],b[d])):a[d]=b[d];return a}function d(a){return c({},a)}function e(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function f(a){if("createEvent"in document){var b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0),a.dispatchEvent(b)}else a.fireEvent("onchange")}function g(a,b,c){if("string"==typeof b){var d=b;b={},b[d]=c}for(var e in b)a.style[e]=b[e]}function h(a,b){a.classList?a.classList.add(b):a.className+=" "+b}function i(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(b,"")}function j(a,b){for(var c in b)a.setAttribute(c,b[c])}function k(a){return parseInt(a,10)}function l(a,b){if(!a)throw"Source image missing";var c=new Image;return c.style.opacity="0",new Promise(function(d,e){function f(){c.style.opacity="1",setTimeout(function(){d(c)},1)}c.removeAttribute("crossOrigin"),a.match(/^https?:\/\/|^\/\//)&&c.setAttribute("crossOrigin","anonymous"),c.onload=function(){b?EXIF.getData(c,function(){f()}):f()},c.onerror=function(a){c.style.opacity=1,setTimeout(function(){e(a)},1)},c.src=a})}function m(a,b){var c=a.naturalWidth,d=a.naturalHeight,e=b||n(a);if(e&&e>=5){var f=c;c=d,d=f}return{width:c,height:d}}function n(a){return a.exifdata&&a.exifdata.Orientation?k(a.exifdata.Orientation):1}function o(a,b,c){var d=b.width,e=b.height,f=a.getContext("2d");switch(a.width=b.width,a.height=b.height,f.save(),c){case 2:f.translate(d,0),f.scale(-1,1);break;case 3:f.translate(d,e),f.rotate(180*Math.PI/180);break;case 4:f.translate(0,e),f.scale(1,-1);break;case 5:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.scale(1,-1);break;case 6:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.translate(0,-e);break;case 7:a.width=e,a.height=d,f.rotate(-90*Math.PI/180),f.translate(-d,e),f.scale(1,-1);break;case 8:a.width=e,a.height=d,f.translate(0,d),f.rotate(-90*Math.PI/180)}f.drawImage(b,0,0,d,e),f.restore()}function p(){var a,b,c,d,e,f,i=this,k="croppie-container",l=i.options.viewport.type?"cr-vp-"+i.options.viewport.type:null;i.options.useCanvas=i.options.enableOrientation||q.call(i),i.data={},i.elements={},a=i.elements.boundary=document.createElement("div"),c=i.elements.viewport=document.createElement("div"),b=i.elements.img=document.createElement("img"),d=i.elements.overlay=document.createElement("div"),i.options.useCanvas?(i.elements.canvas=document.createElement("canvas"),i.elements.preview=i.elements.canvas):i.elements.preview=b,h(a,"cr-boundary"),a.setAttribute("aria-dropeffect","none"),e=i.options.boundary.width,f=i.options.boundary.height,g(a,{width:e+(isNaN(e)?"":"px"),height:f+(isNaN(f)?"":"px")}),h(c,"cr-viewport"),l&&h(c,l),g(c,{width:i.options.viewport.width+"px",height:i.options.viewport.height+"px"}),c.setAttribute("tabindex",0),h(i.elements.preview,"cr-image"),j(i.elements.preview,{alt:"preview","aria-grabbed":"false"}),h(d,"cr-overlay"),i.element.appendChild(a),a.appendChild(i.elements.preview),a.appendChild(c),a.appendChild(d),h(i.element,k),i.options.customClass&&h(i.element,i.options.customClass),x.call(this),i.options.enableZoom&&t.call(i),i.options.enableResize&&r.call(i)}function q(){return this.options.enableExif&&window.EXIF}function r(){function a(a){if((void 0===a.button||0===a.button)&&(a.preventDefault(),!o)){var g=m.elements.overlay.getBoundingClientRect();if(o=!0,e=a.pageX,f=a.pageY,d=a.currentTarget.className.indexOf("vertical")!==-1?"v":"h",i=g.width,j=g.height,a.touches){var h=a.touches[0];e=h.pageX,f=h.pageY}window.addEventListener("mousemove",b),window.addEventListener("touchmove",b),window.addEventListener("mouseup",c),window.addEventListener("touchend",c),document.body.style[V]="none"}}function b(a){var b=a.pageX,c=a.pageY;if(a.preventDefault(),a.touches){var h=a.touches[0];b=h.pageX,c=h.pageY}var k=b-e,l=c-f,o=m.options.viewport.height+l,q=m.options.viewport.width+k;"v"===d&&o>=p&&o<=j?(g(n,{height:o+"px"}),m.options.boundary.height+=l,g(m.elements.boundary,{height:m.options.boundary.height+"px"}),m.options.viewport.height+=l,g(m.elements.viewport,{height:m.options.viewport.height+"px"})):"h"===d&&q>=p&&q<=i&&(g(n,{width:q+"px"}),m.options.boundary.width+=k,g(m.elements.boundary,{width:m.options.boundary.width+"px"}),m.options.viewport.width+=k,g(m.elements.viewport,{width:m.options.viewport.width+"px"})),y.call(m),C.call(m),w.call(m),z.call(m),f=c,e=b}function c(){o=!1,window.removeEventListener("mousemove",b),window.removeEventListener("touchmove",b),window.removeEventListener("mouseup",c),window.removeEventListener("touchend",c),document.body.style[V]=""}var d,e,f,i,j,k,l,m=this,n=document.createElement("div"),o=!1,p=50;h(n,"cr-resizer"),g(n,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),this.options.resizeControls.height&&(k=document.createElement("div"),h(k,"cr-resizer-vertical"),n.appendChild(k)),this.options.resizeControls.width&&(l=document.createElement("div"),h(l,"cr-resizer-horisontal"),n.appendChild(l)),k&&(k.addEventListener("mousedown",a),k.addEventListener("touchstart",a)),l&&(l.addEventListener("mousedown",a),l.addEventListener("touchstart",a)),this.elements.boundary.appendChild(n)}function s(a){if(this.options.enableZoom){var b=this.elements.zoomer,c=M(a,4);b.value=Math.max(parseFloat(b.min),Math.min(parseFloat(b.max),c)).toString()}}function t(){function a(){u.call(c,{value:parseFloat(e.value),origin:new aa(c.elements.preview),viewportRect:c.elements.viewport.getBoundingClientRect(),transform:_.parse(c.elements.preview)})}function b(b){var d,e;return"ctrl"===c.options.mouseWheelZoom&&b.ctrlKey!==!0?0:(d=b.wheelDelta?b.wheelDelta/1200:b.deltaY?b.deltaY/1060:b.detail?b.detail/-60:0,e=c._currentZoom+d*c._currentZoom,b.preventDefault(),s.call(c,e),void a.call(c))}var c=this,d=c.elements.zoomerWrap=document.createElement("div"),e=c.elements.zoomer=document.createElement("input");h(d,"cr-slider-wrap"),h(e,"cr-slider"),e.type="range",e.step="0.0001",e.value="1",e.style.display=c.options.showZoomer?"":"none",e.setAttribute("aria-label","zoom"),c.element.appendChild(d),d.appendChild(e),c._currentZoom=1,c.elements.zoomer.addEventListener("input",a),c.elements.zoomer.addEventListener("change",a),c.options.mouseWheelZoom&&(c.elements.boundary.addEventListener("mousewheel",b),c.elements.boundary.addEventListener("DOMMouseScroll",b))}function u(a){function b(){var a={};a[U]=d.toString(),a[T]=f.toString(),g(c.elements.preview,a)}var c=this,d=a?a.transform:_.parse(c.elements.preview),e=a?a.viewportRect:c.elements.viewport.getBoundingClientRect(),f=a?a.origin:new aa(c.elements.preview);if(c._currentZoom=a?a.value:c._currentZoom,d.scale=c._currentZoom,c.elements.zoomer.setAttribute("aria-valuenow",c._currentZoom),b(),c.options.enforceBoundary){var h=v.call(c,e),i=h.translate,j=h.origin;d.x>=i.maxX&&(f.x=j.minX,d.x=i.maxX),d.x<=i.minX&&(f.x=j.maxX,d.x=i.minX),d.y>=i.maxY&&(f.y=j.minY,d.y=i.maxY),d.y<=i.minY&&(f.y=j.maxY,d.y=i.minY)}b(),ba.call(c),z.call(c)}function v(a){var b=this,c=b._currentZoom,d=a.width,e=a.height,f=b.elements.boundary.clientWidth/2,g=b.elements.boundary.clientHeight/2,h=b.elements.preview.getBoundingClientRect(),i=h.width,j=h.height,k=d/2,l=e/2,m=(k/c-f)*-1,n=m-(i*(1/c)-d*(1/c)),o=(l/c-g)*-1,p=o-(j*(1/c)-e*(1/c)),q=1/c*k,r=i*(1/c)-q,s=1/c*l,t=j*(1/c)-s;return{translate:{maxX:m,minX:n,maxY:o,minY:p},origin:{maxX:r,minX:q,maxY:t,minY:s}}}function w(a){var b=this,c=b._currentZoom,d=b.elements.preview.getBoundingClientRect(),e=b.elements.viewport.getBoundingClientRect(),f=_.parse(b.elements.preview.style[U]),h=new aa(b.elements.preview),i=e.top-d.top+e.height/2,j=e.left-d.left+e.width/2,k={},l={};if(a){var m=h.x,n=h.y,o=f.x,p=f.y;k.y=m,k.x=n,f.y=o,f.x=p}else k.y=i/c,k.x=j/c,l.y=(k.y-h.y)*(1-c),l.x=(k.x-h.x)*(1-c),f.x-=l.x,f.y-=l.y;var q={};q[T]=k.x+"px "+k.y+"px",q[U]=f.toString(),g(b.elements.preview,q)}function x(){function a(a,b){var c=o.elements.preview.getBoundingClientRect(),d=n.y+b,e=n.x+a;o.options.enforceBoundary?(m.top>c.top+b&&m.bottom<c.bottom+b&&(n.y=d),m.left>c.left+a&&m.right<c.right+a&&(n.x=e)):(n.y=d,n.x=e)}function b(a){o.elements.preview.setAttribute("aria-grabbed",a),o.elements.boundary.setAttribute("aria-dropeffect",a?"move":"none")}function c(a){function b(a){switch(a){case c:return[1,0];case e:return[0,1];case f:return[-1,0];case g:return[0,-1]}}var c=37,e=38,f=39,g=40;if(!a.shiftKey||a.keyCode!==e&&a.keyCode!==g){if(o.options.enableKeyMovement&&a.keyCode>=37&&a.keyCode<=40){a.preventDefault();var h=b(a.keyCode);n=_.parse(o.elements.preview),document.body.style[V]="none",m=o.elements.viewport.getBoundingClientRect(),d(h)}}else{var i;i=a.keyCode===e?parseFloat(o.elements.zoomer.value)+parseFloat(o.elements.zoomer.step):parseFloat(o.elements.zoomer.value)-parseFloat(o.elements.zoomer.step),o.setZoom(i)}}function d(b){var c=b[0],d=b[1],e={};a(c,d),e[U]=n.toString(),g(o.elements.preview,e),y.call(o),document.body.style[V]="",w.call(o),z.call(o),l=0}function e(a){if((void 0===a.button||0===a.button)&&(a.preventDefault(),!p)){if(p=!0,j=a.pageX,k=a.pageY,a.touches){var c=a.touches[0];j=c.pageX,k=c.pageY}b(p),n=_.parse(o.elements.preview),window.addEventListener("mousemove",h),window.addEventListener("touchmove",h),window.addEventListener("mouseup",i),window.addEventListener("touchend",i),document.body.style[V]="none",m=o.elements.viewport.getBoundingClientRect()}}function h(b){b.preventDefault();var c=b.pageX,d=b.pageY;if(b.touches){var e=b.touches[0];c=e.pageX,d=e.pageY}var h=c-j,i=d-k,m={};if("touchmove"===b.type&&b.touches.length>1){var p=b.touches[0],q=b.touches[1],r=Math.sqrt((p.pageX-q.pageX)*(p.pageX-q.pageX)+(p.pageY-q.pageY)*(p.pageY-q.pageY));l||(l=r/o._currentZoom);var t=r/l;return s.call(o,t),void f(o.elements.zoomer)}a(h,i),m[U]=n.toString(),g(o.elements.preview,m),y.call(o),k=d,j=c}function i(){p=!1,b(p),window.removeEventListener("mousemove",h),window.removeEventListener("touchmove",h),window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i),document.body.style[V]="",w.call(o),z.call(o),l=0}var j,k,l,m,n,o=this,p=!1;o.elements.overlay.addEventListener("mousedown",e),o.elements.viewport.addEventListener("keydown",c),o.elements.overlay.addEventListener("touchstart",e)}function y(){if(this.elements){var a=this,b=a.elements.boundary.getBoundingClientRect(),c=a.elements.preview.getBoundingClientRect();g(a.elements.overlay,{width:c.width+"px",height:c.height+"px",top:c.top-b.top+"px",left:c.left-b.left+"px"})}}function z(){var a=this,b=a.get();if(A.call(a))if(a.options.update.call(a,b),a.$&&"undefined"==typeof Prototype)a.$(a.element).trigger("update.croppie",b);else{var c;window.CustomEvent?c=new CustomEvent("update",{detail:b}):(c=document.createEvent("CustomEvent"),c.initCustomEvent("update",!0,!0,b)),a.element.dispatchEvent(c)}}function A(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function B(){var a,b=this,c=1,d={},e=b.elements.preview,f=new _(0,0,c),h=new aa,i=A.call(b);i&&!b.data.bound&&(b.data.bound=!0,d[U]=f.toString(),d[T]=h.toString(),d.opacity=1,g(e,d),a=b.elements.preview.getBoundingClientRect(),b._originalImageWidth=a.width,b._originalImageHeight=a.height,b.data.orientation=q.call(b)?n(b.elements.img):b.data.orientation,b.options.enableZoom?C.call(b,!0):b._currentZoom=c,f.scale=b._currentZoom,d[U]=f.toString(),g(e,d),b.data.points.length?D.call(b,b.data.points):E.call(b),w.call(b),y.call(b))}function C(a){var b,c,d,e,g=this,h=Math.max(g.options.minZoom,0)||0,i=g.options.maxZoom||1.5,j=g.elements.zoomer,k=parseFloat(j.value),l=g.elements.boundary.getBoundingClientRect(),n=m(g.elements.img,g.data.orientation),o=g.elements.viewport.getBoundingClientRect();g.options.enforceBoundary&&(d=o.width/n.width,e=o.height/n.height,h=Math.max(d,e)),h>=i&&(i=h+1),j.min=M(h,4),j.max=M(i,4),!a&&(k<j.min||k>j.max)?s.call(g,k<j.min?j.min:j.max):a&&(c=Math.max(l.width/n.width,l.height/n.height),b=null!==g.data.boundZoom?g.data.boundZoom:c,s.call(g,b)),f(j)}function D(a){if(4!==a.length)throw"Croppie - Invalid number of points supplied: "+a;var b=this,c=a[2]-a[0],d=b.elements.viewport.getBoundingClientRect(),e=b.elements.boundary.getBoundingClientRect(),f={left:d.left-e.left,top:d.top-e.top},h=d.width/c,i=a[1],j=a[0],k=-1*a[1]+f.top,l=-1*a[0]+f.left,m={};m[T]=j+"px "+i+"px",m[U]=new _(l,k,h).toString(),g(b.elements.preview,m),s.call(b,h),b._currentZoom=h}function E(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=a.elements.boundary.getBoundingClientRect(),e=c.left-d.left,f=c.top-d.top,h=e-(b.width-c.width)/2,i=f-(b.height-c.height)/2,j=new _(h,i,a._currentZoom);g(a.elements.preview,U,j.toString())}function F(a){var b=this,c=b.elements.canvas,d=b.elements.img,e=c.getContext("2d");e.clearRect(0,0,c.width,c.height),c.width=d.width,c.height=d.height;var f=b.options.enableOrientation&&a||n(d);o(c,d,f)}function G(a){var b=this,c=a.points,d=k(c[0]),e=k(c[1]),f=k(c[2]),g=k(c[3]),h=f-d,i=g-e,j=a.circle,l=document.createElement("canvas"),m=l.getContext("2d"),n=a.outputWidth||h,o=a.outputHeight||i;l.width=n,l.height=o,a.backgroundColor&&(m.fillStyle=a.backgroundColor,m.fillRect(0,0,n,o));var p=d,q=e,r=h,s=i,t=0,u=0,v=n,w=o;return d<0&&(p=0,t=Math.abs(d)/h*n),r+p>b._originalImageWidth&&(r=b._originalImageWidth-p,v=r/h*n),e<0&&(q=0,u=Math.abs(e)/i*o),s+q>b._originalImageHeight&&(s=b._originalImageHeight-q,w=s/i*o),m.drawImage(this.elements.preview,p,q,r,s,t,u,v,w),j&&(m.fillStyle="#fff",m.globalCompositeOperation="destination-in",m.beginPath(),m.arc(l.width/2,l.height/2,l.width/2,0,2*Math.PI,!0),m.closePath(),m.fill()),l}function H(a){var b=a.points,c=document.createElement("div"),d=document.createElement("img"),e=b[2]-b[0],f=b[3]-b[1];return h(c,"croppie-result"),c.appendChild(d),g(d,{left:-1*b[0]+"px",top:-1*b[1]+"px"}),d.src=a.url,g(c,{width:e+"px",height:f+"px"}),c}function I(a){return G.call(this,a).toDataURL(a.format,a.quality)}function J(a){var b=this;return new Promise(function(c){G.call(b,a).toBlob(function(a){c(a)},a.format,a.quality)})}function K(a){this.elements.img.parentNode&&(Array.prototype.forEach.call(this.elements.img.classList,function(b){a.classList.add(b)}),this.elements.img.parentNode.replaceChild(a,this.elements.img),this.elements.preview=a),this.elements.img=a}function L(a,b){var c,d=this,e=[],f=null,g=q.call(d);if("string"==typeof a)c=a,a={};else if(Array.isArray(a))e=a.slice();else{if("undefined"==typeof a&&d.data.url)return B.call(d),z.call(d),null;c=a.url,e=a.points||[],f="undefined"==typeof a.zoom?null:a.zoom}return d.data.bound=!1,d.data.url=c||d.data.url,d.data.boundZoom=f,l(c,g).then(function(c){if(K.call(d,c),e.length)d.options.relative&&(e=[e[0]*c.naturalWidth/100,e[1]*c.naturalHeight/100,e[2]*c.naturalWidth/100,e[3]*c.naturalHeight/100]);else{var f,g,h=m(c),i=d.elements.viewport.getBoundingClientRect(),j=i.width/i.height,k=h.width/h.height;k>j?(g=h.height,f=g*j):(f=h.width,g=h.height/j);var l=(h.width-f)/2,n=(h.height-g)/2,o=l+f,p=n+g;d.data.points=[l,n,o,p]}d.data.orientation=a.orientation||1,d.data.points=e.map(function(a){return parseFloat(a)}),d.options.useCanvas&&F.call(d,d.data.orientation),B.call(d),z.call(d),b&&b()})}function M(a,b){return parseFloat(a).toFixed(b||0)}function N(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=c.left-b.left,e=c.top-b.top,f=(c.width-a.elements.viewport.offsetWidth)/2,g=(c.height-a.elements.viewport.offsetHeight)/2,h=d+a.elements.viewport.offsetWidth+f,i=e+a.elements.viewport.offsetHeight+g,j=a._currentZoom;(j===1/0||isNaN(j))&&(j=1);var k=a.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;return d=Math.max(k,d/j),e=Math.max(k,e/j),h=Math.max(k,h/j),i=Math.max(k,i/j),{points:[M(d),M(e),M(h),M(i)],zoom:j,orientation:a.data.orientation}}function O(a){var b,e=this,f=N.call(e),g=c(d(ca),d(a)),h="string"==typeof a?a:g.type||"base64",i=g.size||"viewport",j=g.format,k=g.quality,l=g.backgroundColor,m="boolean"==typeof g.circle?g.circle:"circle"===e.options.viewport.type,n=e.elements.viewport.getBoundingClientRect(),o=n.width/n.height;return"viewport"===i?(f.outputWidth=n.width,f.outputHeight=n.height):"object"==typeof i&&(i.width&&i.height?(f.outputWidth=i.width,f.outputHeight=i.height):i.width?(f.outputWidth=i.width,f.outputHeight=i.width/o):i.height&&(f.outputWidth=i.height*o,f.outputHeight=i.height)),da.indexOf(j)>-1&&(f.format="image/"+j,f.quality=k),f.circle=m,f.url=e.data.url,f.backgroundColor=l,b=new Promise(function(a){switch(h.toLowerCase()){case"rawcanvas":a(G.call(e,f));break;case"canvas":case"base64":a(I.call(e,f));break;case"blob":J.call(e,f).then(a);break;default:a(H.call(e,f))}})}function P(){B.call(this)}function Q(a){if(!this.options.useCanvas||!this.options.enableOrientation)throw"Croppie: Cannot rotate without enableOrientation && EXIF.js included";var c=this,d=c.elements.canvas;if(c.data.orientation=b(c.data.orientation,a),o(d,c.elements.img,c.data.orientation),w.call(c,!0),C.call(c),Math.abs(a)/90%2===1){var e=c._originalImageHeight,f=c._originalImageWidth;c._originalImageWidth=e,c._originalImageHeight=f}}function R(){var a=this;a.element.removeChild(a.elements.boundary),i(a.element,"croppie-container"),a.options.enableZoom&&a.element.removeChild(a.elements.zoomerWrap),delete a.elements}function S(a,b){if(a.className.indexOf("croppie-container")>-1)throw new Error("Croppie: Can't initialize croppie more than once");if(this.element=a,this.options=c(d(S.defaults),b),"img"===this.element.tagName.toLowerCase()){var e=this.element;h(e,"cr-original-image"),j(e,{"aria-hidden":"true",alt:""});var f=document.createElement("div");this.element.parentNode.appendChild(f),f.appendChild(e),this.element=f,this.options.url=this.options.url||e.src}if(p.call(this),this.options.url){var g={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,L.call(this,g)}}"function"!=typeof Promise&&!function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j=setTimeout,k="function"==typeof setImmediate&&setImmediate||function(a){j(a,1)},l=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){k=a},"undefined"!=typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this),"undefined"!=typeof window&&"function"!=typeof window.CustomEvent&&!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),"undefined"==typeof HTMLCanvasElement||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){for(var d=atob(this.toDataURL(b,c).split(",")[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;g++)f[g]=d.charCodeAt(g);a(new Blob([f],{type:b||"image/png"}))}});var T,U,V,W=["Webkit","Moz","ms"],X="undefined"!=typeof document?document.createElement("div").style:{},Y=[1,8,3,6],Z=[2,7,4,5];U=a("transform"),T=a("transformOrigin"),V=a("userSelect");var $={translate3d:{suffix:", 0px"},translate:{suffix:""}},_=function(a,b,c){this.x=parseFloat(a),this.y=parseFloat(b),this.scale=parseFloat(c)};_.parse=function(a){return a.style?_.parse(a.style[U]):a.indexOf("matrix")>-1||a.indexOf("none")>-1?_.fromMatrix(a):_.fromString(a)},_.fromMatrix=function(a){var b=a.substring(7).split(",");return b.length&&"none"!==a||(b=[1,0,0,1,0,0]),new _(k(b[4]),k(b[5]),parseFloat(b[0]))},_.fromString=function(a){var b=a.split(") "),c=b[0].substring(S.globals.translate.length+1).split(","),d=b.length>1?b[1].substring(6):1,e=c.length>1?c[0]:0,f=c.length>1?c[1]:0;return new _(e,f,d)},_.prototype.toString=function(){var a=$[S.globals.translate].suffix||"";return S.globals.translate+"("+this.x+"px, "+this.y+"px"+a+") scale("+this.scale+")"};var aa=function(a){if(!a||!a.style[T])return this.x=0,void(this.y=0);var b=a.style[T].split(" ");this.x=parseFloat(b[0]),this.y=parseFloat(b[1])};aa.prototype.toString=function(){return this.x+"px "+this.y+"px"};var ba=e(y,500),ca={type:"canvas",format:"png",quality:1},da=["jpeg","webp","png"];if("undefined"!=typeof window&&window.jQuery){var ea=window.jQuery;ea.fn.croppie=function(a){var b=typeof a;if("string"===b){var c=Array.prototype.slice.call(arguments,1),d=ea(this).data("croppie");return"get"===a?d.get():"result"===a?d.result.apply(d,c):"bind"===a?d.bind.apply(d,c):this.each(function(){var b=ea(this).data("croppie");if(b){var d=b[a];if(!ea.isFunction(d))throw"Croppie "+a+" method not found";d.apply(b,c),"destroy"===a&&ea(this).removeData("croppie")}})}return this.each(function(){var b=new S(this,a);b.$=ea,ea(this).data("croppie",b)})}}return S.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function(){}},S.globals={translate:"translate3d"},c(S.prototype,{bind:function(a,b){return L.call(this,a,b)},get:function(){var a=N.call(this),b=a.points;return this.options.relative&&(b[0]/=this.elements.img.naturalWidth/100,b[1]/=this.elements.img.naturalHeight/100,b[2]/=this.elements.img.naturalWidth/100,b[3]/=this.elements.img.naturalHeight/100),a},result:function(a){return O.call(this,a)},refresh:function(){return P.call(this)},setZoom:function(a){s.call(this,a),f(this.elements.zoomer)},rotate:function(a){Q.call(this,a)},destroy:function(){return R.call(this)}}),S});