define(["jquery"],function(a){function b(b){this.contentTab=a(b),this.id=this.contentTab.attr("id"),this.loadUri=this.contentTab.data("load");var c='.tab-container ul a[data-tab="#'+a(this).attr("id")+'"]';this.tab=a(c),this.preloaded=this.contentTab.data().hasOwnProperty("preloaded"),this.page=this.contentTab.data("page")||1,this.perpage=this.contentTab.data("perpage")||10,this.sort=this.contentTab.data("default-sort")||"-weight",this.region=this.contentTab.data("default-region")||0,this.totalResults=this.contentTab.find("[data-result-count]").addBack("[data-result-count]").data("resultCount"),this.preloaded||this.contentTab.hide()}var c={};return b.prototype.load=function(b){var c=a.extend({append:!1,loader:!1},b),d=this.contentTab,e=this.tab.find(".count"),f={search:a('#localcoursesearch input[name="search"]').val(),page:this.page,perpage:this.perpage,sort:this.sort,region:this.region},g=c.append?"loading-append":"loading-replace";d.removeClass("loading-append loading-replace").addClass("loading "+g);var h=a.Deferred(),i=this;return a.get(this.loadUri,f,function(b){if(i.totalResults=a(b).find("[data-result-count]").addBack("[data-result-count]").data("resultCount"),e.text(i.totalResults),c.append){var f=a(b).find(c.append);d.find(c.append).last().after(f)}else d.html(b);setTimeout(function(){d.removeClass("loading loading-append loading-replace")},0),h.resolve(b)}),h},b.prototype.setPage=function(a){return this.page=a,this},b.prototype.setSort=function(a){return this.sort=a,this},b.prototype.setRegion=function(a){return this.region=a,this},b.prototype.focus=function(){this.tab.parent().addClass("active").siblings().removeClass("active"),this.contentTab.addClass("open").show().siblings().removeClass("open").hide(),a(document).trigger(a.Event("tabchanged",{tab:this}))},b.findSearchTab=function(b){if(a(b).parents(".nav-tabs").length)var b=a(b).data("tab");var d=a(b).closest(".tab-content").attr("id");return c[d]},b.create=function(a){var d=new b(a);return c[d.id]=d,d},a(".tab-content[data-load]").each(function(){var a=b.create(this);a.preloaded||a.load()}),a(".tab-container").on("click","ul a",function(a){a.preventDefault();var c=b.findSearchTab(this);c.focus()}),window.location.hash.length&&a('.tab-container ul a[data-tab="'+window.location.hash+'"]').trigger("click"),b});