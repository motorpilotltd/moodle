define(["jquery","local_catalogue/repository","local_catalogue/paged_content_factory","local_catalogue/pubsub","core/custom_interaction_events","core/notification","core/templates","local_catalogue/paged_content_events"],function(a,b,c,d,e,f,g,h){var i={COURSE_VIEW:'[data-region="courses-view"]',COURSE_REGION:'[data-region="course-view-content"]',PLACEHOLDER_REGION:'[data-region="loading-placeholder-content"]',LOADMORE:".catalogueloadmore",SEARCH:'[data-action="search-catalogue"]'},j={COURSES_CARDS:"local_catalogue/view-cards",COURSES_LIST:"local_catalogue/view-list",COURSES_SUMMARY:"local_catalogue/view-summary",NOCOURSES:"local_catalogue/no-courses"},k=[12,24,48],l=0,m=function(a){var b=a.find(i.COURSE_VIEW),c=window.location.hash;"#new"==c&&localStorage.setItem("data-metadata","");var d=localStorage.getItem("data-metadata")?localStorage.getItem("data-metadata"):b.attr("data-metadata"),e=localStorage.getItem("data-display")?localStorage.getItem("data-display"):b.attr("data-display");if(""!==b.attr("data-search")){var f=b.attr("data-search");localStorage.removeItem("data-search")}else var f=localStorage.getItem("data-search");return{display:e,metadata:d,category:b.attr("data-category"),search:f}},n={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,persistentLimitKey:"local_catalogue_user_paging_preference"},o=function(a,c){return b.getCoursesByClassification({offset:l,limit:c,metadata:a.metadata,category:a.category,search:a.search})},p=function(a,b,c){var d="";return d="cards"==c.display?j.COURSES_CARDS:"list"==c.display?j.COURSES_LIST:j.COURSES_SUMMARY,b.courses.length?g.render(d,{courses:b.courses,placeholderimage:M.cfg.wwwroot+"/local/catalogue/pix/placeholderimage.png"}):g.render(j.NOCOURSES,{})},q=function(a){a.find(i.COURSE_VIEW).addClass("hidden"),a.find(i.PLACEHOLDER_REGION).removeClass("hidden")},r=function(a){a.find(i.COURSE_VIEW).removeClass("hidden"),a.find(i.PLACEHOLDER_REGION).addClass("hidden"),a.find(i.SEARCH).prop("disabled",!1)},s=function(b){b=a(b),q(b);var e=b.find(i.COURSE_VIEW);l=0;var j=m(b),s=c.createWithLimit(k,function(a,c){var d=[];return a.forEach(function(a){var e=a.pageNumber-1,g=o(j,a.limit,e).then(function(d){return d.courses.length<a.limit&&c.allItemsLoaded(a.pageNumber),l=d.nextoffset,p(b,d,j)})["catch"](f.exception);d.push(g)}),d},n);s.then(function(a,b){g.replaceNodeContents(e,a,b)})["catch"](f.exception),d.subscribe("paged-content-container"+h.PAGES_SHOWN,function(){r(b)}),d.subscribe("paged-content-container"+h.START_LOADING,function(){q(b)})};return{init:s}});