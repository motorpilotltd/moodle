local_taps_enrolment

tapsenrol_iw_tracking
map enrolmentid to tapsenrol_class_enrolments.id

New local_learningrecordstore table:
provider
healthandsafetycategory
origin (where it originated from -> could be 3rd party or a specific activity (for cpd))
originid (could be a classid, moodle courseid, lynda video id etc.)
staffid
duration
durationunits
completiontime (consolidation of classcompletiontime as classcompletiondate, needs turning into timestamp)
description (currently learningdesc)
certificateno
originname (coursename)
starttime take from classstarttime in tapsenrol
endtime take from classendtime in tapsenrol
classcategory
classcost
classcostcurrency
timemodified (consolidation of timemodified as lastupdatedate)
expirydate
classtype (currently learning method)



New tapsenrol_class_enrolments table:
classid
bookingstatus
completiontime
userid (mapped from staffid)
active
timemodified (consolidation of timemodified as lastupdatedate)
archived

to remove:
pricebasis - never written to DONE
bookingplaceddate - never written to except to be equal to timemodified DONE
stadffid - remap to userid on tapsenrol, leave for lrs (DONE)
lastupdatedate (use timemodified) DONE
classcompletiondate (just going to use classcompletiontime renamed to completiontime from now) DONE
classcontext (appears to only ever be null or 'health and safety') DELETED
courseid (DONE)
cpdid (seems to be some kind of additional primary key) DELETE EXCEPT local/reports DONE
enrolmentid (seems to be some kind of additional primary key) (DONE)
learningdesccont1 (never used) DELETED
learningdesccont2 (never used) DELETED
personid (absent in last 97k records and not referenced anywhere in Moodle) DELETED
courseobjectives duplicated from taps course table (now metadata field, only different in 6 cases) DELETED

duplicated on local_taps_class so can be removed:
trainingcenter (never different) DONE
classname (never different) DONE
classtype (never different) DONE
classstartdate (one difference) DONE
classenddate (two differences) DONE
classstarttime (one difference) DONE (DROPPED FROM ENROLMENT TABLE BUT RETAINED AS starttime IN LRS)
classendtime (one difference) DONE (DROPPED FROM ENROLMENT TABLE BUT RETAINED AS endtime IN LRS)
duration/classduration (never different) DONE
location (never different) DONE
durationunits/classdurationunits (never different - ignoring change in format...) DONE
durationunitscode (never different) DONE
timezone (never different) DONE
usedtimezone (never different) DONE
price DON
provider/classsuppliername  DONE (stays as provider for cpd records, becomes classsuppliername
courseid DONE

local_taps_class:
rename usedtimezone to timezone
drop date columns where a corresponding time exists

Should replace classid with PK from class table

((\$enrolment->)|(lte.))courseid

to confirm:
price and currencycode _may_ be able to be dropped. There were multiple cost/currency fields in TAPS to represent cost to the company vs cost to attendee. The requirement to distinguish was not continued after the initial migration so I'd imagine can be removed.
where cpdid is null it's because it's an enrolment record so should appear in tapsenrol_class_enrolments where it is not null it's a cpd record and should go in local_learningrecordstore - can also infer from presence of a classid