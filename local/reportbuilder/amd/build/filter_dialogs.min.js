define(["jquery","core/config","core/str"],function(a,b,c){var d={waitingitems:[],reportid:0,init:function(b,c,e,f,g){d.waitingitems.push({filter:b,value:c,hierarchytype:e,name:f}),d.reportid=g,window.dialogsInited?this.rb_init_filter_dialogs():(a.isArray(window.dialoginits)||(window.dialoginits=[]),1===this.waitingitems.length&&window.dialoginits.push(this.rb_init_filter_dialogs))},rb_init_filter_dialogs:function(){var b=a.extend(!0,[],d.waitingitems);d.waitingitems=[],a.each(b,function(){switch(this.filter){case"badge":d.rb_load_badge_filters(this);break;case"cohort":d.rb_load_cohort_filters();break;case"category":d.rb_load_category_filters();break;case"course_multi":d.rb_load_course_multi_filters()}}),a(document).on("click",".multiselect-selected-item a",function(b){b.preventDefault();var c=a(this).parents("div.multiselect-selected-item"),d=c.data("filtername"),e=c.data("id"),f=a("input[name="+d+"]"),g=f.val(),h=g.split(","),i=a.grep(h,function(a){return a!=e}),j=i.join(",");f.val(j),c.remove()})},rb_load_cohort_filters:function(){a("div.rb-cohort-add-link a").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/local/reportbuilder/ajax/";c.get_string("choosecohorts","totara_cohort").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find_cohort.php?sesskey="+b.sesskey,e+"save_cohort.php?sesskey="+b.sesskey+"&filtername="+d+"&ids=")})})},rb_load_badge_filters:function(d){a("div.rb-badge-add-link a").each(function(){var e=a(this).attr("id");e=e.substr(5,e.length-12);var f=b.wwwroot+"/local/reportbuilder/ajax/";c.get_string("choosebadges","badges").done(function(a){totaraMultiSelectDialogRbFilter(e,a,f+"find_badge.php?reportid="+d.value+"&sesskey="+b.sesskey,f+"save_badge.php?filtername="+e+"&sesskey="+b.sesskey+"&ids=")})})},rb_load_category_filters:function(){a(document).on("change","#id_course_category-path_op",function(b){b.preventDefault();var c=a(this).attr("name");c=c.substr(0,c.length-3),"0"===a(this).val()?(a("input[name="+c+"_rec]").prop("disabled",!0),a("#show-"+c+"-dialog").prop("disabled",!0)):(a("input[name="+c+"_rec]").prop("disabled",!1),a("#show-"+c+"-dialog").prop("disabled",!1))}),a("input.rb-filter-choose-category").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/local/reportbuilder/ajax/filter/category/";c.get_string("choosecatplural","local_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find.php?sesskey="+b.sesskey,e+"save.php?filtername="+d+"&sesskey="+b.sesskey+"&ids=")}),"0"===a("select[name="+d+"_op]").val()&&(a("input[name="+d+"_rec]").prop("disabled",!0),a("#show-"+d+"-dialog").prop("disabled",!0))})},rb_load_course_multi_filters:function(){a(document).on("change","#id_course-id_op",function(b){b.preventDefault();var c=a(this).attr("name");c=c.substr(0,c.length-3),"0"===a(this).val()?(a("input[name="+c+"_rec]").prop("disabled",!0),a("#show-"+c+"-dialog").prop("disabled",!0)):(a("input[name="+c+"_rec]").prop("disabled",!1),a("#show-"+c+"-dialog").prop("disabled",!1))}),a("input.rb-filter-choose-course").each(function(){var d=a(this).attr("id");d=d.substr(5,d.length-12);var e=b.wwwroot+"/local/reportbuilder/ajax/filter/course_multi/";c.get_string("coursemultiitemchoose","local_reportbuilder").done(function(a){totaraMultiSelectDialogRbFilter(d,a,e+"find.php?sesskey="+b.sesskey,e+"save.php?filtername="+d+"&sesskey="+b.sesskey+"&ids=")}),"0"===a("select[name="+d+"_op]").val()&&(a("input[name="+d+"_rec]").prop("disabled",!0),a("#show-"+d+"-dialog").prop("disabled",!0))})}};return d});