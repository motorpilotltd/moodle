define(["jquery"],function(a){var b={SELECTORS:{ENROLMENTBUTTONS:".expandenrol"},init:function(c,d){a("body").on("click",".rb-display-expand",b.displayExpand),a("body").on("click",this.SELECTORS.ENROLMENTBUTTONS,b.clickEnrol),a("body").on("click",".rb-display-expand-link",function(a){a.stopPropagation()})},displayExpand:function(b){var c=this;if(a(this).attr("clicked"))return a(".rb-expand-row").remove(),void a(this).attr({clicked:null});var d=a(".rb-display-table-container").attr("id"),e=M.cfg.wwwroot+"/local/reportbuilder/ajax/expand.php?id="+d+"&expandname="+a(this).data("name")+"&sesskey="+M.cfg.sesskey;a(this).data("param")&&(e=e+"&"+a(this).data("param")),a.post(e).done(function(b){a(".rb-expand-row").remove(),a(".rb-display-table-container div").attr({clicked:null});var d=a(b).find(".rb-expand-row"),e=a(c).closest("tr").find("td").length;d.find("td.rb-expand-cell").attr({colspan:e}),d.insertAfter(a(c).closest("tr")),a(c).attr({clicked:!0})})},clickEnrol:function(b){var c=a(b.target),d=a('input[type="hidden"][name="courseid"]').attr("value"),e=a(".rb-display-table-container").attr("id"),f=M.cfg.wwwroot+"/local/reportbuilder/ajax/expand.php",g=a(c).parents("form")[0],h=a(g).serialize();h+="&expandname=course_details",h+="&expandcourseid="+d,h+="&id="+e,h+="&instancesubmitted="+c.attr("name");var i=a('[data-param="expandcourseid='+d+'"]');a.post(f,h).done(function(b){b.hasOwnProperty("error")&&(M.cfg.developerdebug?YUI().use("moodle-core-notification-ajaxexception",function(){new M.core.ajaxException(b)}):YUI().use("moodle-core-notification-alert",function(){new M.core.alert({message:b.error,title:M.util.get_string("error","moodle")})}));var c=a(b).find('input[type="hidden"][name="redirect"]');if(c.length)return void(window.location=c.attr("value"));"success"===b&&(a(".rb-expand-row").remove(),a(".rb-display-table-container div").attr({clicked:null}),i.trigger("click")),a(".rb-expand-row").remove(),a(".rb-display-table-container div").attr({clicked:null});var d=a(b).find(".rb-expand-row"),e=a(i).closest("tr").find("td").length;d.find("td.rb-expand-cell").attr({colspan:e}),d.insertAfter(a(i).closest("tr")),i.attr({clicked:!0})})}};return b});