
{{!
    This file is part of Moodle - http://moodle.org/
     Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
     Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
     You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_reportbuilder/report

    Displays a custom report
}}

<div class="reportbuilder_report newreport">
    {{#hasdisabledfilters}}
        {{{ notification }}}
    {{/hasdisabledfilters}}

    <div>
        <h2>{{{ heading }}}</h2>
    </div>

    <nav id="report-controls" class="navbar navbar-default sticky-top m-b-0" data-region="report-controls" aria-label="reportfilters" style="display: flex;">

        <form class="navbar-form" action="{{{formurl}}}" method="post" accept-charset="utf-8" style="display: flex;">
            <div class="input-group">
                <input type="text" name="simplesearch" class="form-control" placeholder="{{#str}}search{{/str}}"
                {{#simplesearch}}value="{{{ simplesearch }}}"{{/simplesearch}}
                aria-label="{{#str}}search{{/str}}">
                <span class="input-group-addon" data-action="submit-search">
                    <i class="fa fa-search"></i>
                </span>
                <span class="input-group-addon hidden" data-action="clear-search">
                    <span class="sr-only">{{#str}}clear{{/str}}</span>
                    <i class="fa fa-close text-danger"></i>
                </span>
            </div>
        </form>
        <div class="navbar-form" style="flex: 1 1 auto; display: flex">
            <div class="input-group" style="flex: 1 1 auto; display: flex">
                <a
                    id="advancedsearchbutton"
                    class="btn btn-link closed"
                    data-toggle="collapse" href="#advancedsearch" aria-expanded="false" aria-controls="advancedsearch"
                    style="margin-right: auto;"
                >
                    <i class="fa fa-caret-right open"></i>
                    <i class="fa fa-caret-down closed"></i> Advanced search
                </a>
                <button
                    class="btn btn-default showhidecolumns"
                    data-action="showcolumns"
                >
                    <i class="fa fa-columns"></i> Table columns
                </button>
                <button
                    class="btn btn-default control-filters"
                    data-action="showfilters"
                >
                    <i class="fa fa-filter"></i> Filters
                </button>

            </div>
        </div>
    </nav>
    <div class="reportcontainer">
        <div id="advancedsearch" data-region="advancedsearch" class="collapse">
            <div class="container-fluid">
                <div class="bg-advancedsearch m-b-1 row">
                    <div class="col-md-7 p-a-1">
                        {{{ search }}}
                    </div>
                    <div class="col-md-5 p-a-1">
                        {{{ savedsearch }}}
                    </div>
                </div>
            </div>
        </div>
        <div data-region="report-table">
            <div class="m-y-1">
                <div class="label label-info">{{{ numrecords }}}</div>
            </div>
            {{{ table }}}
        </div>
        <div id="reportfilters" class="report-filters bg-success p-a-1 inactive" data-region="filters">
            {{{ sidebar }}}
        </div>
    </div>

    <div>
        {{{ export }}}
        <a
            id="showquerybutton"
            class="btn btn-link closed"
            data-toggle="collapse" href="#showquery" aria-expanded="false" aria-controls="showquery"
            style="margin-right: auto;"
        >
            <i class="fa fa-caret-right open"></i>
            <i class="fa fa-caret-down closed"></i> Show Query
        </a>
        <div id="showquery" data-region="advancedsearch" class="collapse">
            <div class="p-a-1 m-b-1">
            {{{ debug }}}
            </div>
        </div>
    </div>

</div>

{{#js}}
require(
[
    'jquery',
],
function(
    $
) {
    $('#advancedsearch').on('hidden.bs.collapse', function () {
        $('#advancedsearchbutton').removeClass('open');
        $('#advancedsearchbutton').addClass('closed');
    });
    $('#advancedsearch').on('show.bs.collapse', function () {
        $('#advancedsearchbutton').removeClass('closed');
        $('#advancedsearchbutton').addClass('open');
    });

    $('#showquery').on('hidden.bs.collapse', function () {
        $('#showquerybutton').removeClass('open');
        $('#showquerybutton').addClass('closed');
    });
    $('#showquery').on('show.bs.collapse', function () {
        $('#showquerybutton').removeClass('closed');
        $('#showquerybutton').addClass('open');
    });
    var filtersbtn = $('[data-action="showfilters"]');
    filtersbtn.on('click', function(e) {
        $("#reportfilters").toggleClass('active');
        e.preventDefault();
    });
});
{{/js}}