{{!
    This file is part of the Online Appraisal Plugin for Arup.
}}
{{!
    @template local_onlineappraisal/feedback

    Display the feedback page which includes a table with contributors and a form
}}
{{! 
    <div data-region="feedback">
    <hr>
    Appraisee: appraiseename
    <hr>
    </div>
    <a id="feedback" class="btn btn-default">feedback</a>
}}

<hr class="tophr">
<div class="oa-tagline">{{tagline}}</div>

{{^hasform}}
<h2>{{#str}}feedback, local_onlineappraisal{{/str}}</h2>
<div class="m-b-10">
{{#str}}feedback_intro, local_onlineappraisal{{/str}}
</div>
{{/hasform}}
{{#showconditions}}
<div class="alert alert-warning" role="alert">
    {{#str}}feedback_setface2face, local_onlineappraisal{{/str}}
</div>
{{/showconditions}}
{{#hasrequests}}
    {{#canadd}}
    <a href="{{{link}}}" class="btn btn-primary">{{#str}}addfeedback, local_onlineappraisal{{/str}}</a>
    {{#linkreceivedfeedback}}
    <a href="{{{linkreceivedfeedback}}}" class="btn btn-default">{{#str}}addreceivedfeedback, local_onlineappraisal{{/str}}</a>
    {{/linkreceivedfeedback}}
    {{/canadd}}
{{/hasrequests}}

{{#hasrequests}}
<table class="generaltable m-b-0">
    <thead>
        <tr>
            <th>{{#str}}feedback_contributor, local_onlineappraisal{{/str}}</th>
            <th>{{#str}}feedback_email_address, local_onlineappraisal{{/str}}</th>
            <th>{{#str}}feedback_sent_date, local_onlineappraisal{{/str}}</th>
            <th class="text-center w-1">{{#str}}feedback_status, local_onlineappraisal{{/str}}</th>
            <th class="w-1">&nbsp;</th>
        </tr>
    </thead>
    <tbody>
    {{#requests}}
        <tr>
            <td>{{name}}</td>
            <td>{{email}}
            {{#emailform}}
                <form action="{{{formurl}}}" method="post" class="mform">
                <div class="input-group inline-edit">
                    <input type="hidden" name="feedbackaction" value="edit">
                   <input type="text" name="replaceaddress" class="form-control" value="{{emailplaceholder}}">
                    <span class="input-group-btn">
                    <input type="submit" class="btn btn-default" type="button" value="Save">
                  </span>
                </div>
                </form>
            {{/emailform}}
            </td>
            <td>{{date}}</td>
            <td class="text-center w-1">{{#received}}<i class="fa fa-check {{^confidential}}text-success{{/confidential}}" title="{{#confidential}}{{#str}}feedbackrequests:received:confidential, local_onlineappraisal{{/str}}{{/confidential}}{{^confidential}}{{#str}}feedbackrequests:received:nonconfidential, local_onlineappraisal{{/str}}{{/confidential}}"></i>{{/received}}</td>
            <td class="w-1">
                {{#hasactions}}
                    <div class="dropdown">
                        <button id="oa-actions-{{id}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="table-button">
                            {{#str}}actions, local_onlineappraisal{{/str}} <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" aria-labelledby="oa-current-{{id}}">
                            {{#actions}}
                            <li><a href="{{{url}}}">{{name}}</a></li>
                            {{/actions}}
                        </ul>
                    </div>
                {{/hasactions}}

            </td>
        </tr>
        {{#viewfeedback}}
        <tr>
            <td colspan="5">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="panel-title">
                        {{#confidential}}
                            {{#str}}feedbackrequests:paneltitle:confidential, local_onlineappraisal{{/str}}
                        {{/confidential}}
                        {{^confidential}}
                            {{#str}}feedbackrequests:paneltitle:nonconfidential, local_onlineappraisal{{/str}}
                        {{/confidential}}
                        <div class="btn-group pull-right">
                        <a href="{{{closeurl}}}" class="btn btn-info btn-sm"> X  </a>
                        </div>
                        </div>
                    </div>
                    <div class="panel-body">
                    {{{viewfeedback}}}
                    {{#viewfeedback_2}}<hr>{{/viewfeedback_2}}
                    {{{viewfeedback_2}}}
                    </div>
                </div>
            </td>
        </tr>
        {{/viewfeedback}}
        {{#customemail}}
        <tr>
            <td colspan="5">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="panel-title">
                            {{#str}}feedbackrequests:paneltitle:requestmail, local_onlineappraisal{{/str}}
                        <div class="btn-group pull-right">
                        <a href="{{{closeurl}}}" class="btn btn-info btn-sm"> X  </a>
                        </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        {{{customemail}}}
                    </div>
                </div>
            </td>
        </tr>
        {{/customemail}}
    {{/requests}}
    </tbody>
</table>
<div class="m-b-15 p-l-5 small">
    {{#str}}feedbackrequests:legend, local_onlineappraisal{{/str}}
</div>
<a href="{{{nextpage}}}" class="btn btn-success">{{#str}}form:nextpage, local_onlineappraisal{{/str}}</a>
{{/hasrequests}}

{{{form}}}

{{#js}}
    require(['local_onlineappraisal/feedback'], function(feedback) {
        feedback.replacestrings();
    });
{{/js}}