define(["jquery","core/config","core/str","core/notification","theme_bootstrap/bootstrap"],function(a,b,c,d){return{init:function(e,f,g,h){if("userinfo"===g&&("appraisee"===f||"appraiser"===f)&&5>h){var i,j,k,l=a("#id_grade"),m=a("#id_jobtitle");c.get_strings([{key:"form:userinfo:refresh",component:"local_onlineappraisal"},{key:"form:userinfo:refresh:tooltip",component:"local_onlineappraisal"}]).done(function(b){i="oa-refresh-datahub fa fa-2x fa-refresh m-l-10 pull-left",j=a('<i class="'+i+'"><span class="sr-only">'+b[0]+"</span></i>"),j.css("cursor","pointer").prop("title",b[1]).data({appraisalid:e,view:f}),k=j.clone(!0),l.addClass("pull-left").after(j),m.addClass("pull-left").after(k),j.data("field","grade"),k.data("field","jobtitle"),a(".oa-refresh-datahub").tooltip()}).fail(d.exception),a(".felement").on("click",".oa-refresh-datahub",function(){var e=a(this);if(!e.data("processing")){e.data("processing",!0),e.addClass("fa-spin");var f=a('<div class="alert clear" role="alert"></div><').hide();c.get_string("error:request","local_onlineappraisal").done(function(c){a.ajax({type:"POST",url:b.wwwroot+"/local/onlineappraisal/ajax.php?sesskey="+b.sesskey,data:{c:"appraisal",a:"userinfo_datahub_update",appraisalid:e.data("appraisalid"),view:e.data("view"),field:e.data("field")},success:function(b){"object"!=typeof b&&(b={success:!1,message:c,data:""}),b.success?(f.removeClass("alert-danger").addClass("alert-success"),"undefined"!=typeof b.data.grade&&l.val(b.data.grade),"undefined"!=typeof b.data.jobtitle&&m.val(b.data.jobtitle)):f.removeClass("alert-success").addClass("alert-danger"),e.data("processing",!1).removeClass("fa-spin"),f.html(b.message),e.next(".alert").remove(),f.insertAfter(e).slideDown().delay(5e3).slideUp(function(){a(this).remove()})},error:function(){f.removeClass("alert-success").addClass("alert-danger"),f.html(c),e.next(".alert").remove(),f.insertAfter(e).slideDown().delay(5e3).slideUp(function(){a(this).remove()}),e.data("processing",!1).removeClass("fa-spin")}})}).fail(d.exception)}})}"successionplan"===g&&(a(".oa-add-repeating-element").show(),a(".oa-add-repeating-element").click(function(b){b.preventDefault();var c=a(this),d=c.data("index"),e=parseInt(d)+1;c.data("index",e);var f=c.data("type"),g=c.parent().find("#fitem_id_"+f+"_"+d).clone();g.prop("id","fitem_id_"+f+"_"+e);var h=g.find("label");h.prop("for","id_"+f+"_"+e);var i=g.find("input");i.prop("id","id_"+f+"_"+e),i.prop("name","strength["+e+"]"),i.val(""),g.insertBefore(c)})),a("#oa-save-nag-modal").length&&(setTimeout(function(){a("#oa-save-nag-modal").modal({backdrop:"static",keyboard:!1})},9e5),a(".oa-save-nag-modal-save").click(function(){a("#oa-save-nag-modal").modal("hide"),window.scrollTo(0,a("#id_submitbutton").offset().top),a(this).closest("form").find("#id_submitbutton").click()}),a('input[type="submit"]').click(function(){var b=a(this),c=b.closest("form");c.data("clicked-name",b.prop("name")),c.data("clicked-value",b.prop("value"))}),c.get_string("error:sessioncheck","local_onlineappraisal").done(function(c){a(".oa-save-session-check").submit(function(d){var e=a(this);if("cancelbutton"===e.data("clicked-name")){var f=a('<input type="hidden" />').prop("name",e.data("clicked-name")).prop("value",e.data("clicked-value"));return void f.appendTo(e)}var g=!1,h=a(this).find("#fgroup_id_buttonar"),i=h.find("input"),j=a('<div class="alert m-l-15" role="alert"></div>').hide();i.prop("disabled",!0),a.ajax({async:!1,type:"POST",url:b.wwwroot+"/local/onlineappraisal/ajax.php?sesskey="+b.sesskey,data:{c:"appraisal",a:"check_session"},success:function(b){if("object"!=typeof b&&(b={success:!1,message:c,data:""}),b.success){g=!0;var d=a('<input type="hidden" />').prop("name",e.data("clicked-name")).prop("value",e.data("clicked-value"));d.appendTo(e)}else j.removeClass("alert-success").addClass("alert-danger"),j.html(c),h.find(".alert").remove(),j.appendTo(h).slideDown(),i.prop("disabled",!1),i.blur()},error:function(){j.removeClass("alert-success").addClass("alert-danger"),j.html(c),h.find(".alert").remove(),j.appendTo(h).slideDown(),i.prop("disabled",!1),i.blur()}}),g||d.preventDefault()})}).fail(d.exception))}}});