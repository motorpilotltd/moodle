require.config({enforceDefine:!1,paths:{select2_4_0_8:["https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/js/select2.min",M.cfg.wwwroot+"/pluginfile.php/"+M.cfg.contextid+"/local_onlineappraisal/vendor/select2_4.0.8.min"]}}),define(["jquery","core/config","core/str","core/notification","theme_bootstrap/bootstrap","select2_4_0_8"],function(a,b,c,d){var e={leadership:{select:a("select#id_leadership")},roles:{select:a("select#id_leadershiproles"),div:a("#fitem_id_leadershiproles")},attributes:{select:a("select#id_leadershipattributes"),div:a("#fitem_id_leadershipattributes"),wrapper:a("#oa-development-leadershipattributes"),tables:a("#oa-development-leadershipattributes table.oa-table-leadership-attributes")}},f=function(a){"Yes"===a.val()?(e.roles.div.show(0,function(){e.roles.select.hasClass("select2-hidden-accessible")||c.get_string("form:development:leadershiproles:placeholder","local_onlineappraisal").done(function(a){e.roles.select.select2({maximumSelectionLength:2,placeholder:a})})}),e.attributes.wrapper.show(),e.attributes.div.show(0,function(){e.attributes.select.hasClass("select2-hidden-accessible")||e.attributes.select.select2({maximumSelectionLength:3})})):(e.roles.select.val(null).trigger("change.select2"),g(),e.roles.div.hide())},g=function(){c.get_string("form:development:leadershiproles:answer:generic","local_onlineappraisal").done(function(b){m(!0);var c=e.roles.select.val(),d=a.inArray(b,c),f=e.attributes.select.val();c.length>1&&d>-1&&(e.roles.select.val(null).val(b).trigger("change.select2"),c=e.roles.select.val()),d>-1?(e.attributes.tables.each(function(){var b=a(this);"generic"===b.data("type")?b.show():(b.find('i[data-toggle="popover"]').popover("hide"),l(b.find("button"),"selected",!0).each(function(){var b=a(this);i(b);var c=a.inArray(b.data("option"),f);-1!==c&&f.splice(c,1)}),e.attributes.select.val(f).trigger("change.select2"),b.hide())}),a("#oa-development-leadershipattributes-detailed").hide()):c.length>0&&(e.attributes.tables.each(function(){var b=a(this);"role"===b.data("type")?(b.show(),k(b,c)):(b.find('i[data-toggle="popover"]').popover("hide"),l(b.find("button"),"selected",!0).each(function(){var b=a(this);i(b);var c=a.inArray(b.data("option"),f);-1!==c&&f.splice(c,1)}),b.hide())}),a("#oa-development-leadershipattributes-detailed").show()),c.length>0?(e.attributes.wrapper.show(),e.attributes.div.show()):(e.attributes.select.val(null).trigger("change.select2"),e.attributes.tables.find('i[data-toggle="popover"]').popover("hide"),l(e.attributes.tables.find("button"),"selected",!0).each(function(){i(a(this))}),e.attributes.wrapper.hide(),e.attributes.div.hide()),m(!1)})},h=function(b){var f=e.attributes.select.val(),g=b.data("option"),h=a.inArray(g,f);if(b.data("selected")||-1!==h?b.data("selected")&&-1!==h&&f.splice(h,1):f.push(g),f.length>3){var j=[{key:"error",component:"local_onlineappraisal"},{key:"form:development:leadershipattributes:error:toomany",component:"local_onlineappraisal"}];c.get_strings(j).done(function(a){d.alert(a[0],a[1],"OK")})}else i(b),m(!0),e.attributes.select.val(f).trigger("change.select2"),m(!1)},i=function(a){a.data("selected",!a.data("selected")),a.toggleClass("btn-default btn-primary").blur()},j=function(){var b=e.attributes.select.val(),c=e.attributes.tables.find("button");c.data("selected",!1),c.removeClass("btn-primary").addClass("btn-default"),a.each(b,function(){var a=l(c,"option",this);a.data("selected",!0),a.removeClass("btn-default").addClass("btn-primary")})},k=function(b,c){var d=b.find("th"),e=0;d.each(function(){var d=a(this),f=d[0].cellIndex+1,g=b.find("th:nth-child("+f+"), td:nth-child("+f+")"),i=g.find('i[data-toggle="popover"]');a.inArray(d.data("column"),c)>-1?(e++,g.show(),1===e?(i.popover("destroy"),i.data("placement","left")):(i.popover("destroy"),i.data("placement","right"))):(i.popover("hide"),g.hide(),l(g.find("button"),"selected",!0).each(function(){h(a(this))}))}),1===c.length?b.removeClass("oa-multi-column").addClass("oa-single-column"):b.removeClass("oa-single-column").addClass("oa-multi-column")},l=function(b,c,d){return b.filter(function(){return a(this).data(c)==d})},m=function(a){a===!0?(e.attributes.select.prop("disabled",!1),e.attributes.select.trigger("change.select2")):(e.attributes.select.prop("disabled",!0),e.attributes.select.trigger("change.select2"))},n=function(a){var b=a.parents("table"),c=b.data("type");if("role"===c){var d=a.parent("td")[0].cellIndex+1;b.find("td:nth-child("+d+') i[data-toggle="popover"]').not(a).popover("hide")}else b.find('i[data-toggle="popover"]').not(a).popover("hide")};return{init:function(i,k,l,o){if(a("select.select2-general").select2(),a("select.select2-general").on("select2:opening select2:closing",function(){var b=a(this).parent().find(".select2-search__field");b.prop("disabled",!0)}),"development"===l&&(e.roles.div.removeClass("hiddenifjs").hide(),e.roles.select.removeClass("hiddenifjs"),e.attributes.wrapper.removeClass("hiddenifjs").hide(),e.attributes.tables.removeClass("hidden").hide(),e.attributes.div.removeClass("hiddenifjs").hide(),e.attributes.select.removeClass("hiddenifjs"),a("#oa-development-leadershipattributes-detailed").removeClass("hidden").hide(),m(!0),f(e.leadership.select),g(),j(),m(!1),e.leadership.select.on("change",function(){f(a(this)),g()}),e.roles.select.on("change",function(){g()}),e.attributes.wrapper.on("click","button",function(b){var c=a(this);b.preventDefault(),c.prop("disabled")||h(c)}),e.attributes.tables.on("click",'i[data-toggle="popover"]',function(){n(a(this))}),e.attributes.select.on("change",function(){j()}),a("#oa-development-leadershipattributes-detailed").on("click",function(c){c.preventDefault();var d="print=leadershipattributes&appraisalid="+i+"&view="+k;a.each(e.roles.select.val(),function(){d=d+"&role[]="+encodeURIComponent(this)});var f=b.wwwroot+"/local/onlineappraisal/print.php?"+d;window.location.href=f}),a("form").on("submit",function(){m(!0)})),"userinfo"===l&&("appraisee"===k||"appraiser"===k)&&5>o){var p,q,r,s=a("#id_grade"),t=a("#id_jobtitle");c.get_strings([{key:"form:userinfo:refresh",component:"local_onlineappraisal"},{key:"form:userinfo:refresh:tooltip",component:"local_onlineappraisal"}]).done(function(b){p="oa-refresh-datahub fa fa-2x fa-refresh m-l-10 pull-left",q=a('<i class="'+p+'"><span class="sr-only">'+b[0]+"</span></i>"),q.css("cursor","pointer").prop("title",b[1]).data({appraisalid:i,view:k}),r=q.clone(!0),s.addClass("pull-left").after(q),t.addClass("pull-left").after(r),q.data("field","grade"),r.data("field","jobtitle"),a(".oa-refresh-datahub").tooltip()}).fail(d.exception),a(".felement").on("click",".oa-refresh-datahub",function(){var e=a(this);if(!e.data("processing")){e.data("processing",!0),e.addClass("fa-spin");var f=a('<div class="alert clear" role="alert"></div><').hide();c.get_string("error:request","local_onlineappraisal").done(function(c){a.ajax({type:"POST",url:b.wwwroot+"/local/onlineappraisal/ajax.php?sesskey="+b.sesskey,data:{c:"appraisal",a:"userinfo_datahub_update",appraisalid:e.data("appraisalid"),view:e.data("view"),field:e.data("field")},success:function(b){"object"!=typeof b&&(b={success:!1,message:c,data:""}),b.success?(f.removeClass("alert-danger").addClass("alert-success"),"undefined"!=typeof b.data.grade&&s.val(b.data.grade),"undefined"!=typeof b.data.jobtitle&&t.val(b.data.jobtitle)):f.removeClass("alert-success").addClass("alert-danger"),e.data("processing",!1).removeClass("fa-spin"),f.html(b.message),e.next(".alert").remove(),f.insertAfter(e).slideDown().delay(5e3).slideUp(function(){a(this).remove()})},error:function(){f.removeClass("alert-success").addClass("alert-danger"),f.html(c),e.next(".alert").remove(),f.insertAfter(e).slideDown().delay(5e3).slideUp(function(){a(this).remove()}),e.data("processing",!1).removeClass("fa-spin")}})}).fail(d.exception)}})}"successionplan"===l&&0===parseInt(a("#oa-sdp-islocked").val())&&"appraisee"!==a("#oa-sdp-view").val()&&(a(".oa-add-repeating-element").show(),a(".oa-add-repeating-element").click(function(b){b.preventDefault();var c=a(this),d=c.data("index"),e=parseInt(d)+1;c.data("index",e);var f=c.data("type"),g=c.parent().find("#fitem_id_"+f+"_"+d).clone();g.prop("id","fitem_id_"+f+"_"+e);var h=g.find("label");h.prop("for","id_"+f+"_"+e);var i=g.find("input");i.prop("id","id_"+f+"_"+e),i.prop("name",f+"["+e+"]"),i.val(""),g.insertBefore(c)}));var u=[{key:"form:successionplan:confirm:unlock:title",component:"local_onlineappraisal"},{key:"form:successionplan:confirm:unlock:question",component:"local_onlineappraisal"},{key:"form:successionplan:confirm:unlock:yes",component:"local_onlineappraisal"},{key:"form:successionplan:confirm:unlock:no",component:"local_onlineappraisal"},{key:"form:save",component:"local_onlineappraisal"}];c.get_strings(u).done(function(b){a("#id_submitbutton.oa-unlock-sdp").click(function(c){c.preventDefault();var e=a(this),f=e.closest("form");f.find("#id_unlock").is(":checked")!==!1&&d.confirm(b[0],b[1],b[2],b[3],function(){M.core_formchangechecker.set_form_submitted();var c=a('<input type="hidden" name="submitbutton" value="'+b[4]+'" />');f.append(c).submit()})})}).fail(d.exception),"leaderplan"===l&&0===parseInt(a("#oa-ldp-islocked").val())&&"appraisee"===a("#oa-ldp-view").val()&&(a(".oa-add-repeating-element").show(),a(".oa-add-repeating-element").click(function(b){b.preventDefault();var c=a(this),d=c.data("index"),e=parseInt(d)+1;c.data("index",e);var f=c.data("type"),g=c.parent().find("#fitem_id_"+f+"_"+d).clone();g.prop("id","fitem_id_"+f+"_"+e);var h=g.find("label");h.prop("for","id_"+f+"_"+e);var i=g.find("input");i.prop("id","id_"+f+"_"+e),i.prop("name",f+"["+e+"]"),i.val(""),g.insertBefore(c)}),a("#ldppotentialnew-add button").click(function(b){b.preventDefault();var c=a(this).parent().prev("input"),d=c.val();""!==d&&(a("select#id_ldppotential").append(a("<option>",{text:d,value:d,selected:!0})),c.val(""))}));var v=[{key:"form:leaderplan:confirm:unlock:title",component:"local_onlineappraisal"},{key:"form:leaderplan:confirm:unlock:question",component:"local_onlineappraisal"},{key:"form:leaderplan:confirm:unlock:yes",component:"local_onlineappraisal"},{key:"form:leaderplan:confirm:unlock:no",component:"local_onlineappraisal"},{key:"form:save",component:"local_onlineappraisal"}];c.get_strings(v).done(function(b){a("#id_submitbutton.oa-unlock-ldp").click(function(c){c.preventDefault();var e=a(this),f=e.closest("form");f.find("#id_ldplocked").is(":checked")===!1&&d.confirm(b[0],b[1],b[2],b[3],function(){M.core_formchangechecker.set_form_submitted();var c=a('<input type="hidden" name="submitbutton" value="'+b[4]+'" />');f.append(c).submit()})})}).fail(d.exception),a("#oa-save-nag-modal").length&&(setTimeout(function(){a("#oa-save-nag-modal").modal({backdrop:"static",keyboard:!1}),a('[data-toggle="popover"]').popover("hide")},9e5),a(".oa-save-nag-modal-save").click(function(){a("#oa-save-nag-modal").modal("hide"),window.scrollTo(0,a("#id_submitbutton").offset().top),a(this).closest("form").find("#id_submitbutton").click()}),a('input[type="submit"]').click(function(){var b=a(this),c=b.closest("form");c.data("clicked-name",b.prop("name")),c.data("clicked-value",b.prop("value"))}),c.get_string("error:sessioncheck","local_onlineappraisal").done(function(c){a(".oa-save-session-check").submit(function(d){var e=a(this);if("cancelbutton"===e.data("clicked-name")){var f=a('<input type="hidden" />').prop("name",e.data("clicked-name")).prop("value",e.data("clicked-value"));return void f.appendTo(e)}var g=!1,h=a(this).find("#fgroup_id_buttonar"),i=h.find("input"),j=a('<div class="alert m-l-15" role="alert"></div>').hide();i.prop("disabled",!0),a.ajax({async:!1,type:"POST",url:b.wwwroot+"/local/onlineappraisal/ajax.php?sesskey="+b.sesskey,data:{c:"appraisal",a:"check_session"},success:function(b){if("object"!=typeof b&&(b={success:!1,message:c,data:""}),b.success){g=!0;var d=a('<input type="hidden" />').prop("name",e.data("clicked-name")).prop("value",e.data("clicked-value"));d.appendTo(e)}else j.removeClass("alert-success").addClass("alert-danger"),j.html(c),h.find(".alert").remove(),j.appendTo(h).slideDown(),i.prop("disabled",!1),i.blur()},error:function(){j.removeClass("alert-success").addClass("alert-danger"),j.html(c),h.find(".alert").remove(),j.appendTo(h).slideDown(),i.prop("disabled",!1),i.blur()}}),g||d.preventDefault()})}).fail(d.exception))}}});