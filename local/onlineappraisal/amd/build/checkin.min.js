define(["jquery","core/config","core/str","core/templates","core/notification","local_onlineappraisal/autosize"],function(a,b,c,d,e,f){return{init:function(){f(a("#oa-checkin-input")),a("#oa-checkin-submit").click(function(g){g.preventDefault();var h=a(this),i=a(".oa-checkins-alert"),j=h.closest("form"),k=j.find("#oa-checkin-input"),l=k.closest(".form-group");if(""===a.trim(k.val()))return l.addClass("has-error"),l.find(".help-block").hide().removeClass("hidden").slideDown(),h.blur(),!1;var m=h.html();h.prop("disabled",!0),c.get_string("comment:addingdots","local_onlineappraisal").done(function(a){h.html('<i class="fa fa-lg fa-fw fa-spinner fa-spin"></i><span class="sr-only">'+a+"</span>")}).fail(e.exception),l.removeClass("has-error"),l.find(".help-block").hide(),c.get_string("error:request","local_onlineappraisal").done(function(g){a.ajax({type:"POST",url:b.wwwroot+"/local/onlineappraisal/ajax.php?sesskey="+b.sesskey,data:j.serializeArray(),success:function(b){"object"!=typeof b&&(b={success:!1,message:g,data:""}),i.hide().removeClass("hidden"),b.success?(c.get_string("form:add","local_onlineappraisal").done(function(b){a("#oa-checkin-submit").html(b)}),k.val(""),f.update(k),i.removeClass("alert-danger").addClass("alert-success"),d.render("local_onlineappraisal/checkin",b.data).done(function(b){a(".oa-checkins ul").prepend(b)}).fail(e.exception),a("#checkinid").val("-1")):i.removeClass("alert-success").addClass("alert-danger"),i.find(".alert-message").html(b.message),i.slideDown().delay(5e3).slideUp(function(){i.find(".alert-message").html("")})},error:function(){h.html(m),i.hide().removeClass("hidden"),i.removeClass("alert-success").addClass("alert-danger"),i.find(".alert-message").html(g),i.slideDown().delay(5e3).slideUp(function(){i.find(".alert-message").html("")})},complete:function(){h.prop("disabled",!1),h.blur()}})}).fail(e.exception)})}}});