define(["jquery","core/config","core/str","core/templates","core/notification","local_onlineappraisal/autosize"],function(a,b,c,d,e,f){return{init:function(g){var h=a(".oa-comments > ul > li");if(h.length>4){h.filter(":gt(3)").hide();var i=a("button.oa-comments-more");i.parent().removeClass("hidden"),i.click(function(){h.filter(":hidden").filter(":lt(4)").show(),a(this).blur(),0===h.filter(":hidden").length&&a(this).hide()})}f(a("#oa-comment-input")),a("#oa-comment-submit").click(function(h){h.preventDefault();var i=a(this),j=a(".oa-comments-alert"),k=i.closest("form"),l=k.find("#oa-comment-input"),m=l.closest(".form-group");if(""===a.trim(l.val()))return m.addClass("has-error"),m.find(".help-block").hide().removeClass("hidden").slideDown(),i.blur(),!1;var n=i.html();i.prop("disabled",!0),c.get_string("comment:addingdots","local_onlineappraisal").done(function(a){i.html('<i class="fa fa-lg fa-fw fa-spinner fa-spin"></i><span class="sr-only">'+a+"</span>")}).fail(e.exception),m.removeClass("has-error"),m.find(".help-block").hide(),c.get_string("error:request","local_onlineappraisal").done(function(c){a.ajax({type:"POST",url:b.wwwroot+"/local/onlineappraisal/ajax.php?sesskey="+b.sesskey,data:k.serializeArray(),success:function(b){"object"!=typeof b&&(b={success:!1,message:c,data:""}),j.hide().removeClass("hidden"),b.success?(l.val(""),f.update(l),j.removeClass("alert-danger").addClass("alert-success"),d.render(g,b.data).done(function(b){a(".oa-comments ul").prepend(b)}).fail(e.exception)):j.removeClass("alert-success").addClass("alert-danger"),j.find(".alert-message").html(b.message),j.slideDown().delay(5e3).slideUp(function(){j.find(".alert-message").html("")})},error:function(){j.hide().removeClass("hidden"),j.removeClass("alert-success").addClass("alert-danger"),j.find(".alert-message").html(c),j.slideDown().delay(5e3).slideUp(function(){j.find(".alert-message").html("")})},complete:function(){i.html(n),i.prop("disabled",!1),i.blur()}})}).fail(e.exception)})}}});