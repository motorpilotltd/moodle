define(["jquery","theme_bootstrap/bootstrap","core/str","local_wa_learning_path/select2"],function(e,l,t){"use strict";return{init:function(){var l=function(o){e.get(o,function(o){e("#myModal .modal-body").html(o);var i=e("#myModal .modal-body #print_section").first();e("#myModal #print_placeholder").replaceWith(i),e("#myModal .modal-body").find("#print_section").hide(),e("#myModal").modal("show"),e("#myModal .matrix_activities .activity_completion").click(function(){1===e(this).data("cpd")&&e(this).hasClass("no")?e("#completionModal").modal("show",e(this)):t(e(this))}),e("#myModal #print_section").click(function(){var l="",t="",o="";e('select[name="levels"]').val()&&(l=e('select[name="levels"]').val().join()),e('select[name="roles"]').val()&&(o=e('select[name="roles"]').val().join()),e(".region").val()&&(t=e(".region").val().join());var a=e(this).prop("href")+"&levels="+l+"&regions="+t+"&role="+o;e(this).prop("href",a)}),e("form.filtration :checkbox, form.filtration select").on("change",function(){a()}),e(".navigate-cells").on("click",function(){return l(e(this).attr("data-url")),!1})})},t=function(l){var o=l.hasClass("no")?1:0,a=l.attr("data-id"),i=l.attr("data-lpathid"),n=l.attr("data-url"),c=e("#completionModal #notes").val(),s=Date.parse(e("#completionModal #date").val())/1e3;return e.ajax({method:"POST",url:n,data:{activityid:a,learningpathid:i,completion:o,datecompleted:s,activitynotes:c}}).done(function(o){var a=l.parent();e(a).html(o),e(a).find(".activity_completion").on("click",function(){1===e(this).data("cpd")&&e(this).hasClass("no")?e("#completionModal").modal("show",e(this)):t(e(this))})}),!1},o=function(l){var o=e("#completionModal #confirmation").is(":checked"),a=Date.parse(e("#completionModal #date").val())/1e3;return a&&o?(t(e(".cpd_currently_completing")),!0):(a||e("#completionModal .label-date").css("color","red"),o||e("#completionModal .label-confirmation").css("color","red"),!1)},a=function(){var l=e("#myModal form.filtration .filter_position :checkbox:checked").map(function(){return e(this).val()}).get(),t=e("#myModal form.filtration .filter_percent :checkbox:checked").map(function(){return parseInt(e(this).val())}).get(),o=e("#myModal form.filtration .filter_methodology select").val();e("#myModal table.list_of_activities tr").each(function(){var a=!1;""!==o&&e(this).data("methodology")!==o&&(a=!0),-1===e.inArray(e(this).data("position"),l)&&(a=!0),t.length<3&&-1===e.inArray(parseInt(e(this).data("percent")),t)&&(a=!0),a?e(this).hide():e(this).show()})},i=function(){var l=e("#myModal .matrix-activities-title"),t=l.data("rlabel"),o=l.data("clabel");e("#completionModal").find("#completionModalLabel2").text(o),e("#completionModal").find("#completionModalLabel3").text(t),e("#completionModal #confirmation").prop("checked",!1),e("#completionModal #notes").val(""),e("#completionModal #date").val((new Date).toISOString().substr(0,10)),e("#completionModal .label-confirmation").css("color","#3c3c3b"),e("#completionModal .label-date").css("color","#3c3c3b")},n=function(l){var t="",o="",a="";e('select[name="levels"]').val()&&(t=e('select[name="levels"]').val()),e('select[name="roles"]').val()&&(a=e('select[name="roles"]').val()),e(".learning_path_matrix .region").val()&&(o=e(".learning_path_matrix .region").val());var i=l+"&levels="+t+"&regions="+o+"&role="+a;window.location=i};e(document).ready(function(e){e("#completionModal #cancel2").on("click",function(){e("#completionModal").modal("hide")}),e("#completionModal #save2").on("click",function(){o(e(this))&&e("#completionModal").modal("hide")}),e('select[name="levels"]').select2({placeholder:"Select level"}),e('select[name="levels"]').on("select2:select",function(){n(e(this).data("url"))}),e('select[name="levels"]').on("select2:unselect",function(){n(e(this).data("url"))}),e('a[data-toggle="modal"]').on("click",function(){return l(this.href),!1}),e("#completionModal").on("show.bs.modal",function(l){var t=e("#myModal .modal-content");e(l.relatedTarget).addClass("cpd_currently_completing"),t.append(e("<div></div>").addClass("modal-gray-out")),i()}),e("#completionModal").on("hide.bs.modal",function(l){e(".activity_completion").removeClass("cpd_currently_completing"),e(".modal-gray-out").remove()}),e("#myModal").on("hide.bs.modal",function(){e(".popover").remove()}),e(".cell_icon_container").on("mouseenter",function(){var l=e(this).parent().attr("id").replace("#","").split("_"),t=l[0],o=l[1];e(".lp_cell").each(function(){e(this).removeClass("cell-highlight"),e(this).removeClass("marked-cell");var l=e(this).attr("id").replace("#","").split("_"),a=l[0],i=l[1];a!=t&&i!=o||e(this).addClass("cell-highlight")}),e(".lp_row_header").each(function(){e(this).removeClass("cell-highlight"),e(this).data("row")==o&&e(this).addClass("cell-highlight")}),e(".lp_col_header").each(function(){e(this).removeClass("cell-highlight"),e(this).data("column")==t&&e(this).addClass("cell-highlight")}),e(this).parent().removeClass("cell-highlight"),e(this).parent().addClass("marked-cell")}),e(".cell_icon_container").on("mouseleave",function(){e(".lp_cell").each(function(){e(this).removeClass("cell-highlight"),e(this).removeClass("marked-cell")}),e(".lp_row_header").each(function(){e(this).removeClass("cell-highlight")}),e(".lp_col_header").each(function(){e(this).removeClass("cell-highlight")})})})}}});