define(["jquery","theme_bootstrap/bootstrap","core/str","local_wa_learning_path/select2"],function(e,t,l){"use strict";return{init:function(){var t=function(o){e.get(o,function(o){e("#myModal .modal-body").html(o);var i=e("#myModal .modal-body #print_section").first();e("#myModal #print_placeholder").replaceWith(i),e("#myModal .modal-body").find("#print_section").hide(),e("#myModal").modal("show"),e("#myModal .matrix_activities .activity_completion").click(function(){1===e(this).data("cpd")&&e(this).hasClass("no")?e("#completionModal").modal("show",e(this)):l(e(this))}),e("#myModal #print_section").click(function(){var t="",l="",o="";e('select[name="levels"]').val()&&(t=e('select[name="levels"]').val().join()),e('select[name="roles"]').val()&&(o=e('select[name="roles"]').val().join()),e(".region").val()&&(l=e(".region").val().join());var a=e(this).prop("href")+"&levels="+t+"&regions="+l+"&role="+o;e(this).prop("href",a)}),e("form.filtration :checkbox, form.filtration select").on("change",function(){a()}),e(".navigate-cells").on("click",function(){return t(e(this).attr("data-url")),!1})})},l=function(t){var o=t.hasClass("no")?1:0,a=t.attr("data-cpd"),i=t.attr("data-id"),n=t.attr("data-lpathid"),c=t.attr("data-url"),r=e("#completionModal #notes").val(),s=Date.parse(e("#completionModal #date").val())/1e3;return!(1==a&&!o)&&(e.ajax({method:"POST",url:c,data:{activityid:i,learningpathid:n,completion:o,datecompleted:s,activitynotes:r}}).done(function(o){var a=t.parent();e(a).html(o),e(a).find(".activity_completion").on("click",function(){1===e(this).data("cpd")&&e(this).hasClass("no")?e("#completionModal").modal("show",e(this)):l(e(this))})}),!1)},o=function(t){var o=e("#completionModal #confirmation").is(":checked"),a=Date.parse(e("#completionModal #date").val())/1e3;return a&&o?(l(e(".cpd_currently_completing")),!0):(a||e("#completionModal .label-date").css("color","red"),o||e("#completionModal .label-confirmation").css("color","red"),!1)},a=function(){var t=e("#myModal form.filtration .filter_position :checkbox:checked").map(function(){return e(this).val()}).get(),l=e("#myModal form.filtration .filter_percent :checkbox:checked").map(function(){return parseInt(e(this).val())}).get(),o=e("#myModal form.filtration .filter_methodology select").val();e("#myModal table.list_of_activities tr").each(function(){var a=!1;""!==o&&e(this).data("methodology")!==o&&(a=!0),-1===e.inArray(e(this).data("position"),t)&&(a=!0),l.length<3&&-1===e.inArray(parseInt(e(this).data("percent")),l)&&(a=!0),a?e(this).hide():e(this).show()})},i=function(){var t=e("#myModal .matrix-activities-title"),l=t.data("rlabel"),o=t.data("clabel");e("#completionModal").find("#completionModalLabel2").text(o),e("#completionModal").find("#completionModalLabel3").text(l),e("#completionModal #confirmation").prop("checked",!1),e("#completionModal #notes").val(""),e("#completionModal #date").val((new Date).toISOString().substr(0,10)),e("#completionModal .label-confirmation").css("color","#3c3c3b"),e("#completionModal .label-date").css("color","#3c3c3b")},n=function(t){var l="",o="",a="";e('select[name="levels"]').val()&&(l=e('select[name="levels"]').val()),e('select[name="roles"]').val()&&(a=e('select[name="roles"]').val()),e(".learning_path_matrix .region").val()&&(o=e(".learning_path_matrix .region").val());var i=t+"&levels="+l+"&regions="+o+"&role="+a;window.location=i};e(document).ready(function(e){e("#completionModal #cancel2").on("click",function(){e("#completionModal").modal("hide")}),e("#completionModal #save2").on("click",function(){o(e(this))&&e("#completionModal").modal("hide")}),e('select[name="levels"]').select2({placeholder:"Select level"}),e('select[name="levels"]').on("select2:select",function(){n(e(this).data("url"))}),e('select[name="levels"]').on("select2:unselect",function(){n(e(this).data("url"))}),e('a[data-toggle="modal"]').on("click",function(){return t(this.href),!1}),e("#completionModal").on("show.bs.modal",function(t){var l=e("#myModal .modal-content");e(t.relatedTarget).addClass("cpd_currently_completing"),l.append(e("<div></div>").addClass("modal-gray-out")),e(".popover").remove(),i()}),e("#completionModal").on("hide.bs.modal",function(t){e(".activity_completion").removeClass("cpd_currently_completing"),e(".modal-gray-out").remove()}),e("#myModal").on("show.bs.modal",function(){e(".popover").remove()}),e("#myModal").on("hide.bs.modal",function(){e(".popover").remove()}),e(".cell_icon_container").on("mouseenter",function(){var t=e(this).parent().attr("id").replace("#","").split("_"),l=t[0],o=t[1];e(".lp_cell").each(function(){e(this).removeClass("cell-highlight"),e(this).removeClass("marked-cell");var t=e(this).attr("id").replace("#","").split("_"),a=t[0],i=t[1];a!=l&&i!=o||e(this).addClass("cell-highlight")}),e(".lp_row_header").each(function(){e(this).removeClass("cell-highlight"),e(this).data("row")==o&&e(this).addClass("cell-highlight")}),e(".lp_col_header").each(function(){e(this).removeClass("cell-highlight"),e(this).data("column")==l&&e(this).addClass("cell-highlight")}),e(this).parent().removeClass("cell-highlight"),e(this).parent().addClass("marked-cell")}),e(".cell_icon_container").on("mouseleave",function(){e(".lp_cell").each(function(){e(this).removeClass("cell-highlight"),e(this).removeClass("marked-cell")}),e(".lp_row_header").each(function(){e(this).removeClass("cell-highlight")}),e(".lp_col_header").each(function(){e(this).removeClass("cell-highlight")})})})}}});