define(["jquery","theme_bootstrap/bootstrap","core/str","local_wa_learning_path/select2"],function(e,t){"use strict";return{init:function(){var t=function(i){e.get(i,function(i){e("#myModal .modal-body").html(i);var n=e("#myModal .modal-body #print_section").first();e("#myModal #print_placeholder").replaceWith(n),e("#myModal .modal-body").find("#print_section").hide(),e("#myModal").modal("show"),e("#myModal .matrix_activities .activity_completion").click(function(){l(e(this))}),e("#myModal #print_section").click(function(){var t="",l="",a="";e('select[name="levels"]').val()&&(t=e('select[name="levels"]').val().join()),e('select[name="roles"]').val()&&(a=e('select[name="roles"]').val().join()),e(".region").val()&&(l=e(".region").val().join());var i=e(this).prop("href")+"&levels="+t+"&regions="+l+"&role="+a;e(this).prop("href",i)}),e("form.filtration :checkbox, form.filtration select").on("change",function(){a()}),e(".navigate-cells").on("click",function(){return t(e(this).attr("data-url")),!1})})},l=function(t){var a=t.hasClass("no")?1:0,i=t.attr("data-id"),n=t.attr("data-lpathid"),o=t.attr("data-url");if(a&&t.data("cpd")&&!window.confirm(str.get_string("confirm:cpdupload","local_wa_learning_path")))return!1;return e.ajax({method:"POST",url:o,data:{activityid:i,learningpathid:n,completion:a}}).done(function(a){var i=t.parent();e(i).html(a),e(i).find(".activity_completion").on("click",function(){l(e(this))})}),!1},a=function(){var t=e("#myModal form.filtration .filter_position :checkbox:checked").map(function(){return e(this).val()}).get(),l=e("#myModal form.filtration .filter_percent :checkbox:checked").map(function(){return parseInt(e(this).val())}).get(),a=e("#myModal form.filtration .filter_methodology select").val();e("#myModal table.list_of_activities tr").each(function(){var i=!1;""!==a&&e(this).data("methodology")!==a&&(i=!0),-1===e.inArray(e(this).data("position"),t)&&(i=!0),l.length<3&&-1===e.inArray(parseInt(e(this).data("percent")),l)&&(i=!0),i?e(this).hide():e(this).show()})},i=function(t){var l="",a="",i="";e('select[name="levels"]').val()&&(l=e('select[name="levels"]').val()),e('select[name="roles"]').val()&&(i=e('select[name="roles"]').val()),e(".learning_path_matrix .region").val()&&(a=e(".learning_path_matrix .region").val());var n=t+"&levels="+l+"&regions="+a+"&role="+i;window.location=n};e(document).ready(function(e){e('select[name="levels"]').select2({placeholder:"Select level"}),e('select[name="levels"]').on("select2:select",function(){i(e(this).data("url"))}),e('select[name="levels"]').on("select2:unselect",function(){i(e(this).data("url"))}),e('a[data-toggle="modal"]').on("click",function(){return t(this.href),!1}),e("#myModal").on("hide.bs.modal",function(){e(".popover").remove()}),e(".cell_icon_container").on("mouseover",function(){var t=e(this).parent().attr("id").replace("#","").split("_"),l=t[0],a=t[1];e(".lp_cell").each(function(){e(this).removeClass("cell-highlight"),e(this).removeClass("marked-cell");var t=e(this).attr("id").replace("#","").split("_"),i=t[0],n=t[1];i!=l&&n!=a||e(this).addClass("cell-highlight")}),e(".lp_row_header").each(function(){e(this).removeClass("cell-highlight"),e(this).data("row")==a&&e(this).addClass("cell-highlight")}),e(".lp_col_header").each(function(){e(this).removeClass("cell-highlight"),e(this).data("column")==l&&e(this).addClass("cell-highlight")}),e(this).parent().removeClass("cell-highlight"),e(this).parent().addClass("marked-cell")})})}}});