define(["jquery","theme_bootstrap/bootstrap"],function(a){function b(a,d,e,f){if(a instanceof Date){var g=[],h="";switch(e){case"m":var i=a.getDate(),h=new Date(a);"undefined"!=typeof f&&1==f?h.setMonth(a.getMonth()-d):h.setMonth(a.getMonth()+d),h.getDate()!=i&&h.setDate(0),29!=a.getDate()||c(h.getFullYear())||(h.setMonth(1),h.setDate(28)),g.expirydate=h;break;case"y":var h=new Date(a);h.setFullYear(a.getFullYear()+d),29!=a.getDate()||c(h.getFullYear())||(h.setMonth(1),h.setDate(28)),g.expirydate=h;break;default:var h=new Date(a);h.setTime(a.getTime()+d),g.expirydate=h}return"undefined"!=typeof g.expirydate&&"undefined"==typeof f?(g.minexpiry=b(g.expirydate,1,"m",!0),g.maxexpiry=b(g.expirydate,1,"m",!1),g):h}}function c(a){return a%4===0&&a%100!==0||a%400===0}return{init:function(c,d){"0"!=c&&0!=c.length&&a('input[type="submit"][name="submitbutton"]').click(function(e){var f=parseInt(c),g="y"==d?12:1,h=f*g,i=a(this),j=0,k=a("#id_completiondate_year").val(),l=a("#id_completiondate_day").val(),m=a("#id_completiondate_month").val();m=parseInt(m)-1;var n=new Date(k,m,l),o=new Date,p=o.getMonth(),q=o.getFullYear(),r=o.getDate(),s=a('input[name="mustendmonth"]').val(),t=a('input[name="requirevalidityperiod"]').val(),u=!0;if("undefined"!=typeof t&&1==t){var v=parseInt(a("#id_validityperiod").val()),w="y"==a("#id_validityperiodunit").val()?12:1;j=v*w;var x=b(n,j,"m",!1);x=x.getTime()/1e3|0,a('input[name="validityexpirydate"]').val(x),j<h&&(u=!1)}else{"undefined"!=typeof s&&1==s?(p=a("#id_expirymonth").val(),p=parseInt(p)-1,q=a("#id_expiryyear").val(),r=new Date(new Date(q,p,1)-1).getDate()):(p=a("#id_expirydate_month").val(),p=parseInt(p)-1,r=a("#id_expirydate_day").val(),q=a("#id_expirydate_year").val());var y=new Date(q,p,r),z=b(n,f,d);u=y>z.minexpiry&&y<z.maxexpiry}!u||!u&&"undefined"!=typeof y&&y>n?(e.preventDefault(),a("#validity-confirm-modal").modal("show"),a("#validity-confirm-modal").on("click","#validity-confirm-btn",function(){a(this).modal("hide"),i.closest("form").submit()})):i.closest("form").submit()})}}});