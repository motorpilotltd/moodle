define(["jquery","theme_bootstrap/bootstrap"],function(a){function b(a,d,e,f){if(a instanceof Date){var g=[],h="";switch(e){case"m":var i=a.getDate(),h=new Date(a);"undefined"!=typeof f&&1==f?h.setMonth(a.getMonth()-d):h.setMonth(a.getMonth()+d),h.getDate()!=i&&h.setDate(0),29!=a.getDate()||c(h.getFullYear())||(h.setMonth(1),h.setDate(28)),g.expirydate=h;break;case"y":var h=new Date(a);h.setFullYear(a.getFullYear()+d),29!=a.getDate()||c(h.getFullYear())||(h.setMonth(1),h.setDate(28)),g.expirydate=h;break;default:var h=new Date(a);h.setTime(a.getTime()+d),g.expirydate=h}return"undefined"!=typeof g.expirydate&&"undefined"==typeof f?(g.minexpiry=b(g.expirydate,1,"m",!0),g.maxexpiry=b(g.expirydate,1,"m",!1),g):h}}function c(a){return a%4===0&&a%100!==0||a%400===0}return{init:function(c,d,e,f){var g=c&&"0"!=d&&0!=d.length,h=g&&"0"==f;(g||h)&&a('input[type="submit"][name="submitbutton"]').click(function(c){var f=a(this);if(!h&&a("#id_exempt").is(":checked"))return void f.closest("form").submit();var g=parseInt(d),i="y"==e?12:1,j=g*i,k=0,l=a("#id_completiondate_year").val(),m=a("#id_completiondate_day").val(),n=a("#id_completiondate_month").val();n=parseInt(n)-1;var o=new Date(l,n,m),p=new Date,q=p.getMonth(),r=p.getFullYear(),s=p.getDate(),t=a('input[name="mustendmonth"]').val(),u=a('input[name="requirevalidityperiod"]').val(),v=!0;if("undefined"!=typeof u&&1==u){var w=parseInt(a("#id_validityperiod").val()),x="y"==a("#id_validityperiodunit").val()?12:1;k=w*x;var y=b(o,k,"m",!1);y=y.getTime()/1e3|0,a('input[name="validityexpirydate"]').val(y),k<j&&(v=!1)}else{"undefined"!=typeof t&&1==t?(q=a("#id_expirymonth").val(),q=parseInt(q)-1,r=a("#id_expiryyear").val(),s=new Date(new Date(r,q,1)-1).getDate()):(q=a("#id_expirydate_month").val(),q=parseInt(q)-1,s=a("#id_expirydate_day").val(),r=a("#id_expirydate_year").val());var z=new Date(r,q,s),A=b(o,g,e);v=z>A.minexpiry&&z<A.maxexpiry}!v||!v&&"undefined"!=typeof z&&z>o?(c.preventDefault(),a("#validity-confirm-modal").modal("show"),a("#validity-confirm-modal").on("click","#validity-confirm-btn",function(){a(this).modal("hide"),f.closest("form").submit()})):f.closest("form").submit()})}}});