define(["jquery","core/config","core/str","core/notification","theme_bootstrap/bootstrap"],function(a,b,c,d){function e(a,b,c,d){if(a instanceof Date){var g=[],h="";switch(c){case"m":var i=a.getDate(),h=new Date(a);"undefined"!=typeof d&&1==d?h.setMonth(a.getMonth()-b):h.setMonth(a.getMonth()+b),h.getDate()!=i&&h.setDate(0),29!=a.getDate()||f(h.getFullYear())||(h.setMonth(1),h.setDate(28)),g.expirydate=h;break;case"y":var h=new Date(a);h.setFullYear(a.getFullYear()+b),29!=a.getDate()||f(h.getFullYear())||(h.setMonth(1),h.setDate(28)),g.expirydate=h;break;default:var h=new Date(a);h.setTime(a.getTime()+b),g.expirydate=h}return"undefined"!=typeof g.expirydate&&"undefined"==typeof d?(g.minexpiry=e(g.expirydate,1,"m",!0),g.maxexpiry=e(g.expirydate,1,"m",!1),g):h}}function f(a){return a%4===0&&a%100!==0||a%400===0}return{init:function(b,c){"0"!=b&&0!=b.length&&a('input[type="submit"]').click(function(d){var f=parseInt(b),g="y"==c?12:1,h=f*g,i=a(this),j=0,k=a("#id_completiondate_year").val(),l=a("#id_completiondate_day").val(),m=a("#id_completiondate_month").val();m=parseInt(m)-1;var n=new Date(k,m,l),o=new Date,p=o.getMonth(),q=o.getFullYear(),r=o.getDate(),s=a('input[name="mustendmonth"]').val(),t=a('input[name="requirevalidityperiod"]').val(),u=!0;if("undefined"!=typeof t&&1==t){var v=parseInt(a("#id_validityperiod").val()),w="y"==a("#id_validityperiodunit").val()?12:1;j=v*w,j<h&&(u=!1)}else{"undefined"!=typeof s&&1==s?(p=a("#id_expirymonth").val(),p=parseInt(p)-1,q=a("#id_expiryyear").val(),r=new Date(new Date(q,p,1)-1).getDate()):(p=a("#id_expirydate_month").val(),p=parseInt(p)-1,r=a("#id_expirydate_day").val(),q=a("#id_expirydate_year").val());var x=new Date(q,p,r),y=e(n,f,c);u=x>y.minexpiry&&x<y.maxexpiry}!u&&x>n?(d.preventDefault(),a("#validity-confirm-modal").modal("show"),a("#validity-confirm-modal").on("click","#validity-confirm-btn",function(){a(this).modal("hide"),i.closest("form").submit()})):i.closest("form").submit()})}}});