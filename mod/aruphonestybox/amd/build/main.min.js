define(["jquery","core/config"],function(a,b){return{initialise:function(){var c=null,d=null,e=null;a("li.aruphonestybox").on("click",'input[type="checkbox"].tapscomplete',function(){if(e=a(this).parent().parent().find(".completion-date"),c=a(this),e.length){var b=e.find(".menufrommonth").val(),f=e.find(".menufromday").val(),g=e.find(".menufromyear").val();d=new Date(g+"/"+b+"/"+f).getTime()/1e3}return c.data("locked")?!1:(a("#myModal").modal({show:!0}),!1)});var f,g=function(a,b){b===!0?(f=a.text(),a.removeClass("btn-success").addClass("btn-default"),a.text("Sending...")):(a.text(f),a.addClass("btn-success").removeClass("btn-default"))};a(".modal").on("click",".btn-success",function(){var f=a(this);g(f,!0);var h=c.data("instance"),i=a("body").attr("class").toString().replace(/^.*course-(\d+)\s.*$/,"$1");a.post(b.wwwroot+"/mod/aruphonestybox/taps.php",{id:h,course:i,completion_date:d}).done(function(b){var d=a.parseJSON(b);g(f,!1);var h=c.parents(".aruphonestybox");h.find(".alert-warning").fadeOut(500),d.success?(c.prop("checked",!0),h.find(".alert-success").hide().removeClass("hide").fadeIn(500),c.parent("div").fadeOut(500),e.fadeOut(500)):(h.find(".alert-danger").hide().removeClass("hide").fadeIn(500),c.prop("checked",!1)),a("#myModal").modal("hide")}).fail(function(){g(f,!1)})})}}});