{"version":3,"sources":["../src/main.js"],"names":["define","$","Sortablearuponepage","Notification","CustomEvents","Ajax","Str","Templates","SELECTORS","SECTION_CONTAINER","SECTION","MODULES_CONTAINER","MODULE","COMPLETIONCHECKS","EXPAND_TOGGLE","EXPAND_SECTIONS","EXPAND_SECTIONS_OPEN","EXPAND_SECTIONS_CLOSED","EXPAND_SECTIONS_CONTENT","COMPLETION_CONTAINER","COMPLETION_INFO","moveSection","args","promise","call","methodname","fail","exception","moveModule","checkCompletion","updateSectionCompletion","root","sectionnumber","targetstate","sectionprogress","find","completedmodules","attr","completionmodules","newCompletionPercentage","get_string","done","s","css","registerEventListeners","contextid","events","activate","on","e","expand","target","closest","openmsg","closedmsg","open","parseInt","each","addClass","removeClass","sectionid","data","isaccordion","sectionname","storeSectionPreference","cc","moduleid","courseid","then","html","replaceNode","completionicon","sectionsContainer","sections","getSectionName","element","text","getModuleName","findClosestSection","sectionsSortable","moveHandlerSelector","getElementName","Deferred","resolve","modulesContainers","modulesSortable","getDestinationName","parentElement","afterElement","length","EVENTS","DROP","info","stopPropagation","positionChanged","targetNextElement","moveElement","sourceList","sourceNextElement","sectiontarget","catch","moduletarget","targetList","countmodules","modulesContainer","nummodules","children","DRAG","oldSectionModules","numoldmodules","newSection","DRAGEND","opened","name","p","preferences","value","JSON","parse","index","indexOf","push","splice","requestset","type","stringify","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for course format workplace list.\n *\n * @package    format_aruponepage\n * @copyright  2019 Moodle Pty Ltd <support@moodle.com>\n * @author     2019 <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @license    Moodle Workplace License, distribution is restricted, contact support@moodle.com\n */\n\ndefine(\n[\n    'jquery',\n    'core/sortable_list',\n    'core/notification',\n    'core/custom_interaction_events',\n    'core/ajax',\n    'core/str',\n    'core/templates'\n],\nfunction(\n    $,\n    Sortablearuponepage,\n    Notification,\n    CustomEvents,\n    Ajax,\n    Str,\n    Templates\n) {\n\n    var SELECTORS = {\n        SECTION_CONTAINER: '[data-region=\"section-container\"]',\n        SECTION: '[data-region=\"section\"]',\n        MODULES_CONTAINER: '[data-region=\"course-modules\"]',\n        MODULE: '[data-region=\"module\"]',\n        COMPLETIONCHECKS: '[data-region=\"completioncheck\"]',\n        EXPAND_TOGGLE: '[data-toggle=\"collapse\"]',\n        EXPAND_SECTIONS: '[data-action=\"expand\"]',\n        EXPAND_SECTIONS_OPEN: '[data-region=\"collapsed-open\"]',\n        EXPAND_SECTIONS_CLOSED: '[data-region=\"collapsed-closed\"]',\n        EXPAND_SECTIONS_CONTENT: '[data-region=\"sectioncollapse\"]',\n        COMPLETION_CONTAINER: '[data-actions=\"availability\"]',\n        COMPLETION_INFO: '[data-region=\"availabilityinfo\"]'\n\n    };\n\n    /**\n     * Move a course section.\n     *\n     * @param {Object} args Arguments to pass to webservice\n     *\n     * Valid args are:t\n     * int sectionnumber number of section to move\n     * int sectiontarget number of section to position after\n     * int courseid.     id of course this module belongs to\n     *\n     * @return {promise} Resolved with void or array of warnings\n     */\n    var moveSection = function(args) {\n        var request = {\n            methodname: 'format_aruponepage_move_section',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n        return promise;\n    };\n\n    /**\n     * Move a course module.\n     *\n     * @param {Object} args Arguments to pass to webservice\n     *\n     * Valid args are:t\n     * int moduleid      id of module to move\n     * int moduletarget  id of module to position after\n     * int sectionnumber number of section to move module to\n     * int courseid.     id of course this section belongs to\n     *\n     * @return {promise} Resolved with void or array of warnings\n     */\n    var moveModule = function(args) {\n        var request = {\n            methodname: 'format_aruponepage_move_module',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n        return promise;\n    };\n\n    /**\n     * Check the completion checkbox for self-completion.\n     *\n     * @param {Object} args Arguments to pass to webservice\n     *\n     * Valid args are:t\n     * int moduleid      id of module to complet\n     * int targetstate   set completion to on (1) or off (0)\n     *\n     * @return {promise} Resolved with void or array of warnings\n     */\n    var checkCompletion = function(args) {\n        var request = {\n            methodname: 'format_aruponepage_module_completion',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n        return promise;\n    };\n\n    /**\n     * Update the section completion progress bar.\n     *\n     * @param {Object} root The course format root container element.\n     * @param {Number} sectionnumber Section ID.\n     * @param {Number} targetstate New state.\n     */\n    var updateSectionCompletion = function(root, sectionnumber, targetstate) {\n        var sectionprogress = root.find('#sectionprogress-' + sectionnumber);\n        var completedmodules = sectionprogress.attr('data-completed-modules');\n        var completionmodules = sectionprogress.attr('data-completion-modules');\n        if (targetstate === 1) {\n            completedmodules++;\n        } else {\n            completedmodules--;\n        }\n        var newCompletionPercentage = 100 * (completedmodules / completionmodules);\n        Str.get_string('section_completion', 'format_aruponepage', newCompletionPercentage).done(function(s) {\n            sectionprogress.attr('title', s);\n            sectionprogress.attr('data-completed-modules', completedmodules);\n            sectionprogress.css('width', newCompletionPercentage + '%');\n        });\n    };\n\n    /**\n     * Listen to, and handle events for the workplace list format.\n     *\n     * @param {Object} root The course format root container element.\n     * @param {Number} contextid Course context ID.\n     */\n    var registerEventListeners = function(root, contextid) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.EXPAND_SECTIONS, function(e) {\n            var expand = $(e.target).closest(SELECTORS.EXPAND_SECTIONS);\n            var openmsg = expand.find(SELECTORS.EXPAND_SECTIONS_OPEN);\n            var closedmsg = expand.find(SELECTORS.EXPAND_SECTIONS_CLOSED);\n            var open = parseInt(expand.attr('data-expanded'));\n            if (open === 0) {\n                $(SELECTORS.EXPAND_SECTIONS_CONTENT).each(function() {\n                    $(this).addClass('show');\n                });\n                $(SELECTORS.EXPAND_TOGGLE).each(function() {\n                    $(this).removeClass('collapsed');\n                });\n                openmsg.removeClass('hidden');\n                closedmsg.addClass('hidden');\n                expand.attr('data-expanded', 1);\n            } else {\n                $(SELECTORS.EXPAND_SECTIONS_CONTENT).each(function() {\n                    $(this).removeClass('show');\n                });\n                $(SELECTORS.EXPAND_TOGGLE).each(function() {\n                    $(this).addClass('collapsed');\n                });\n                openmsg.addClass('hidden');\n                closedmsg.removeClass('hidden');\n                expand.attr('data-expanded', 0);\n            }\n        });\n\n        $(SELECTORS.EXPAND_SECTIONS_CONTENT).on('hidden.bs.collapse', function() {\n            var sectionid = $(this).data('sectionid');\n            var sectionnumber = $(this).data('sectionnumber');\n            var isaccordion = $(this).data('isaccordion');\n            var sectionname = $(this).data('sectionname');\n            Str.get_string('expandsection', 'format_aruponepage', sectionname).done(function(s) {\n                $('.course-section-toggle[data-target=\"#sectioncontent-' + sectionnumber + '\"]').attr('title', s);\n                storeSectionPreference(sectionid, isaccordion, false, contextid);\n            });\n        });\n\n        $(SELECTORS.EXPAND_SECTIONS_CONTENT).on('shown.bs.collapse', function() {\n            var sectionid = $(this).data('sectionid');\n            var sectionnumber = $(this).data('sectionnumber');\n            var isaccordion = $(this).data('isaccordion');\n            var sectionname = $(this).data('sectionname');\n            Str.get_string('collapsesection', 'format_aruponepage', sectionname).done(function(s) {\n                $('.course-section-toggle[data-target=\"#sectioncontent-' + sectionnumber + '\"]').attr('title', s);\n                storeSectionPreference(sectionid, isaccordion, true, contextid);\n            });\n        });\n\n        // Listen for changes on completion.\n        root.on(CustomEvents.events.activate, SELECTORS.COMPLETIONCHECKS, function(e) {\n            var cc = $(e.target).closest(SELECTORS.COMPLETIONCHECKS);\n            var moduleid = parseInt(cc.attr('data-module'));\n            var targetstate = parseInt(cc.attr('data-targetstate'));\n            var courseid = parseInt(cc.attr('data-courseid'));\n            var sectionnumber = parseInt(cc.attr('data-sectionnumber'));\n\n            var args = {\n                moduleid: moduleid,\n                targetstate: targetstate,\n                courseid: courseid\n            };\n\n            checkCompletion(args).then(function(html) {\n                updateSectionCompletion(root, sectionnumber, targetstate);\n                Templates.replaceNode(cc, html.completionicon, '');\n                return null;\n            })\n            .fail(Notification.exception);\n        });\n\n        // Variables for moving sections.\n        var sectionsContainer = root.find(SELECTORS.SECTION_CONTAINER);\n\n        var sections = root.find(SELECTORS.SECTION);\n\n        var courseid = sectionsContainer.attr('data-courseid');\n\n        var getSectionName = function(element) {\n            return element.find('h3.sectionname .inplaceeditable').text();\n        };\n        var getModuleName = function(element) {\n            return element.find('.cmname .inplaceeditable').text();\n        };\n        var findClosestSection = function(element) {\n            return element.closest('[data-region=\"section\"][data-sectionnumber]');\n        };\n\n        var sectionsSortable = new Sortablearuponepage(sectionsContainer, {moveHandlerSelector: '.movesection > [data-drag-type=move]'});\n        sectionsSortable.getElementName = function(element) {\n            return $.Deferred().resolve(getSectionName(element));\n        };\n\n        // Variables for moving modules.\n        var modulesContainers = root.find(SELECTORS.MODULES_CONTAINER);\n\n        var modulesSortable = new Sortablearuponepage(modulesContainers, {moveHandlerSelector: '.movemodule > [data-drag-type=move]'});\n        modulesSortable.getElementName = function(element) {\n            return $.Deferred().resolve(getModuleName(element));\n        };\n        modulesSortable.getDestinationName = function(parentElement, afterElement) {\n            if (!afterElement.length) {\n                return Str.get_string('totopofsection', 'moodle',\n                        getSectionName(findClosestSection(parentElement)));\n            } else {\n                // We check that is not the empty section message.\n                if ($(afterElement).find('.cmname').length === 0) {\n                    return null;\n                } else {\n                    return Str.get_string('movecontentafter', 'moodle', getModuleName(afterElement));\n                }\n            }\n        };\n\n        sections.on(Sortablearuponepage.EVENTS.DROP, function(e, info) {\n            e.stopPropagation();\n            var sectionnumber,\n                args;\n            if (info.positionChanged) {\n                if (info.element.attr('data-sectionnumber')) {\n                    if (info.targetNextElement && info.targetNextElement.attr('data-sectionnumber') === \"0\") {\n                        // Can not move before general section.\n                        sectionsSortable.moveElement(info.sourceList, info.sourceNextElement);\n                        return;\n                    }\n                    sectionnumber = info.element.attr('data-sectionnumber');\n                    var sectiontarget = info.targetNextElement.attr('data-sectionnumber');\n                    args = {\n                        sectionnumber: sectionnumber,\n                        sectiontarget: sectiontarget,\n                        courseid: courseid\n                    };\n                    moveSection(args).then(function() {\n                        info.element.attr('data-sectionnumber', sectiontarget);\n                        info.targetNextElement.attr('data-sectionnumber', sectionnumber);\n                        return null;\n                    }).catch(Notification.exception);\n                }\n                if (info.element.attr('data-module')) {\n                    var moduleid = info.element.attr('data-module');\n                    var moduletarget = info.targetNextElement.attr('data-module');\n                    sectionnumber = findClosestSection(info.targetList).attr('data-sectionnumber');\n                    args = {\n                        moduleid: moduleid,\n                        moduletarget: moduletarget,\n                        sectionnumber: sectionnumber,\n                        courseid: courseid\n                    };\n                    if (typeof moduleid !== 'undefined' && moduleid !== 0) {\n                        moveModule(args).catch(Notification.exception);\n                    }\n                }\n            }\n        });\n\n        // Count the number of modules in each Modules container.\n        var countmodules = function() {\n            root.find(SELECTORS.SECTION).each(function() {\n                var modulesContainer = $(this).find(SELECTORS.MODULES_CONTAINER);\n                var nummodules = modulesContainer.children().length - 1;\n\n                modulesContainer.attr('data-nummodules', nummodules);\n\n                if (nummodules === 0) {\n                    modulesContainer.addClass('nomodules');\n                } else {\n                    modulesContainer.removeClass('nomodules');\n                }\n            });\n        };\n\n        countmodules();\n\n        sections.on(Sortablearuponepage.EVENTS.DRAG, function(e, info) {\n            if (info.element.attr('data-module')) {\n                root.find(SELECTORS.SECTION).each(function() {\n                    $(this).removeClass('movemodule');\n                });\n\n                var oldSectionModules = findClosestSection(info.sourceList).find(SELECTORS.MODULES_CONTAINER);\n                var numoldmodules = parseInt(oldSectionModules.attr('data-nummodules'));\n                if (numoldmodules === 1) {\n                    oldSectionModules.addClass('nomodules');\n                }\n\n                var newSection = findClosestSection(info.targetList);\n                newSection.addClass('movemodule');\n            }\n        });\n\n        sections.on(Sortablearuponepage.EVENTS.DRAGEND, function(e, info) {\n            if (info.element.attr('data-module')) {\n                countmodules();\n            }\n        });\n    };\n\n    /**\n     * Store the user display preference for this section\n     *\n     * @param {Number} sectionid Section ID.\n     * @param {Boolean} isaccordion\n     * @param {Boolean} opened = true or closed = false.\n     * @param {Number} contextid Course context ID.\n     */\n    var storeSectionPreference = function(sectionid, isaccordion, opened, contextid) {\n\n        var requestget = {\n            methodname: 'core_user_get_user_preferences',\n            args: {\n                name: 'format_aruponepage_opensections_' + contextid\n            }\n        };\n\n        var sections = [];\n\n        Ajax.call([requestget])[0]\n            .then(function(p) {\n                if (isaccordion) {\n                    if (opened) {\n                        sections = [sectionid];\n                    } else {\n                        sections = [];\n                    }\n                } else {\n                    if (p.preferences.length && p.preferences[0].value) {\n                        sections = JSON.parse(p.preferences[0].value);\n                    }\n                    var index = sections.indexOf(sectionid);\n                    if (opened) {\n                        if (index === -1) {\n                            sections.push(sectionid);\n                        }\n                    } else {\n                        if (index > -1) {\n                            sections.splice(index, 1);\n                        }\n                    }\n                }\n                var requestset = {\n                    methodname: 'core_user_update_user_preferences',\n                    args: {\n                        preferences: [{\n                            type: 'format_aruponepage_opensections_' + contextid,\n                            value: JSON.stringify(sections)\n                        }]\n                    }\n                };\n                return Ajax.call([requestset])[0];\n            })\n        .fail(Notification.exception);\n    };\n\n    /**\n     * Initialise all of the modules for the workplace list course format.\n     *\n     * @param {object} root The root element for the workplace list course format.\n     * @param {Number} contextid Course context ID.\n     */\n    var init = function(root, contextid) {\n        root = $(root);\n        registerEventListeners(root, contextid);\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"main.min.js"}